{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 87,
  "summary": "Update architecture so the backend runs within the same \"Dart Scoring\" app under the `/api` path (no separate backend app/service or domain). All backend endpoints (rooms, auth, Google OAuth) must be exposed as `/api/...` (e.g. `/api/health`, `/api/auth/google/start`, `/api/auth/google/callback`). Frontend Google login must redirect via `window.location.href = \"/api/auth/google/start\"`, and all references to `dart-scoring-backend.caffeine.xyz` must be removed. Post-deploy verification: `/api/health` returns OK and \"Continue with Google\" opens Google OAuth.",
  "architectural_notes": [
    "Tech stack: Next.js + React + TypeScript; target is a PWA.",
    "Initial routes/pages required: / (Start Game) and /game (Game Screen).",
    "UI first: simple, clean, optimized for tablet/phone with large buttons and readable player cards.",
    "Include a basic layout with a header displaying the app name (Dart Scoring).",
    "Prepare component structure: PlayerCard, Keypad, TurnHistory; do not implement game logic yet (navigation + UI only).",
    "Persist Start Game settings (mode, double out, players) from `/` to `/game` using localStorage as the simplest/stablest approach.",
    "On `/game`, connect UI to core game state: PlayerCard shows remaining and active highlight from currentPlayerIndex; Keypad has input + digit buttons + Enter + quick-score chips (26,41,45,60,85,100,121,140,180); Enter submits to applyTurn() and updates turn history; Undo triggers undoLastTurn(); history list shows last 5 turns.",
    "Persist currentGame to localStorage after each applied turn (and after undo / relevant state transitions) to enable resume.",
    "Replace interactive Double Out confirmation with deterministic Double Out validation in game-core (no awaiting-confirmation state / no confirmation modal).",
    "Add a lightweight checkout-suggestion module/table for common finishes <= 170 (1–3 suggestions), respecting Double Out (must finish on D or Bull when enabled)."
  ],
  "known_issues": [
    "OAuth login frontend crash: components call useOAuthTokenSession but the app is not wrapped in OAuthTokenSessionProvider (or provider is too low in the tree), causing Sign In route to crash instead of rendering the login screen.",
    "\"Continue with Google\" button incorrectly navigates to an in-app `/auth/google` route causing a Not Found page; it must full-page redirect to backend `/auth/google/start` using `NEXT_PUBLIC_BACKEND_URL`, and show \"Google login not configured\" if missing.",
    "Architecture change required: backend must be available under same-app `/api/*` routes; frontend Google OAuth must redirect to `/api/auth/google/start` and all `dart-scoring-backend.caffeine.xyz` references must be removed; verify `/api/health` returns OK after deployment.",
    "/api/* currently returns Not Found in production because Next.js route handlers for `/api/health` and Google OAuth endpoints are missing; must add minimal API handlers (App Router or Pages Router) and redeploy."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-create-two-frontend-routes-pages-start-game-and-game-game-screen-with-working-navigation-between-them-e-g-a-primary-cta-on-that-navigates-to-game-and-a-back-affordance-on-game-that-returns-to",
      "title": "Create two frontend routes/pages: `/` (Start Game) and `/game` (Game Screen), with working navigation between them (e.g., a primary CTA on `/` that navigates to `/game`, and a back affordance on `/game` that returns to `/`).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-shared-app-layout-used-by-both-pages-including-a-header-bar-that-displays-the-app-name-dart-scoring-and-provides-consistent-spacing-padding-suitable-for-tablet-phone-screens",
      "title": "Implement a shared app layout used by both pages, including a header bar that displays the app name \"Dart Scoring\" and provides consistent spacing/padding suitable for tablet/phone screens.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-create-the-requested-ui-component-structure-and-placeholder-implementations-ui-only-no-scoring-rules-playercard-keypad-and-turnhistory-organized-in-a-clear-reusable-folder-structure-under-the-frontend-source-tree",
      "title": "Create the requested UI component structure and placeholder implementations (UI only, no scoring rules): `PlayerCard`, `Keypad`, and `TurnHistory`, organized in a clear, reusable folder structure under the frontend source tree.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-design-a-simple-clean-tablet-phone-first-ui-style-and-apply-it-consistently-across-the-app-colors-typography-spacing-button-sizing-card-styling-keep-controls-large-and-touch-friendly-and-player-cards-highly-legible-use-english-for-all-visible-ui-text",
      "title": "Design a simple, clean, tablet/phone-first UI style and apply it consistently across the app (colors, typography, spacing, button sizing, card styling). Keep controls large and touch-friendly and player cards highly legible. Use English for all visible UI text.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-add-basic-pwa-scaffolding-so-the-app-can-be-installed-include-a-web-app-manifest-name-short-name-display-mode-theme-background-colors-and-reference-it-from-the-frontend-entry-html-ensure-required-app-icons-are-included-as-static-assets",
      "title": "Add basic PWA scaffolding so the app can be installed: include a web app manifest (name, short_name, display mode, theme/background colors) and reference it from the frontend entry HTML; ensure required app icons are included as static assets.",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-add-the-generated-pwa-icon-assets-to-frontend-public-assets-generated-and-wire-them-into-the-manifest-so-they-are-served-statically-do-not-route-images-through-the-backend",
      "title": "Add the generated PWA icon assets to `frontend/public/assets/generated` and wire them into the manifest so they are served statically (do not route images through the backend).",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-the-current-startgamepage-marketing-placeholder-content-with-a-start-game-configuration-form-that-includes-1-game-mode-selection-with-a-radio-group-for-301-vs-501-2-a-double-out-on-off-switch-3-a-player-list-editor-supporting-1-4-players-with-an-add-player-button-per-player-name-input-and-a-remove-button-that-is-disabled-hidden-when-only-1-player-remains-keep-the-ui-touch-friendly-and-consistent-with-the-existing-tailwind-styling",
      "title": "Replace the current `/` (StartGamePage) marketing/placeholder content with a Start Game configuration form that includes: (1) game mode selection with a radio group for 301 vs 501, (2) a 'Double Out' on/off switch, (3) a player list editor supporting 1–4 players with an 'Add player' button, per-player name input, and a remove button that is disabled/hidden when only 1 player remains; keep the UI touch-friendly and consistent with the existing Tailwind styling.",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-stable-settings-handoff-from-to-game-by-persisting-the-selected-mode-double-out-flag-and-player-names-to-localstorage-when-start-game-is-pressed-then-navigate-to-game-on-save-validate-sanitize-player-names-so-there-are-no-empty-names-by-auto-filling-defaults-like-player-1-player-2-etc-based-on-the-player-index-for-any-blank-whitespace-only-inputs",
      "title": "Implement stable settings handoff from `/` to `/game` by persisting the selected mode, double-out flag, and player names to `localStorage` when 'Start Game' is pressed, then navigate to `/game`. On save, validate/sanitize player names so there are no empty names by auto-filling defaults like 'Player 1', 'Player 2', etc. (based on the player index) for any blank/whitespace-only inputs.",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-update-game-gamepage-to-initialize-its-displayed-player-list-and-starting-scores-from-the-saved-localstorage-settings-created-on-if-no-saved-settings-exist-e-g-user-visits-game-directly-fall-back-to-sensible-defaults-mode-501-double-out-off-two-players-named-player-1-and-player-2-without-crashing",
      "title": "Update `/game` (GamePage) to initialize its displayed player list and starting scores from the saved localStorage settings created on `/`. If no saved settings exist (e.g., user visits `/game` directly), fall back to sensible defaults (mode 501, Double Out off, two players named 'Player 1' and 'Player 2') without crashing.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-frontend-game-core-module-that-defines-the-core-data-model-and-state-for-a-darts-scoring-game-including-typescript-types-for-game-player-and-turn-designed-to-be-easy-to-connect-to-the-existing-ui",
      "title": "Create a frontend game-core module that defines the core data model and state for a darts scoring game, including TypeScript types for Game, Player, and Turn, designed to be easy to connect to the existing UI.",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-startgame-settings-to-initialize-a-new-game-state-from-the-saved-settings-mode-301-501-doubleout-flag-player-names-setting-each-player-s-remaining-score-to-the-starting-mode-currentplayerindex-to-the-first-player-and-an-empty-turn-history",
      "title": "Implement startGame(settings) to initialize a new Game state from the saved settings (mode 301/501, doubleOut flag, player names), setting each player's remaining score to the starting mode, currentPlayerIndex to the first player, and an empty turn history.",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-applyturn-scoredpoints-to-update-the-game-state-for-the-current-player-according-to-the-scoring-rules-0-180-validation-bust-handling-double-out-rules-append-an-entry-to-the-turn-history-and-advance-currentplayerindex-when-appropriate",
      "title": "Implement applyTurn(scoredPoints) to update the Game state for the current player according to the scoring rules (0–180 validation, bust handling, Double Out rules), append an entry to the turn history, and advance currentPlayerIndex when appropriate.",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-undolastturn-to-revert-the-game-state-to-exactly-what-it-was-before-the-most-recent-recorded-turn-restoring-per-player-remaining-scores-currentplayerindex-and-any-related-flags-including-needsdoubleconfirmation",
      "title": "Implement undoLastTurn() to revert the Game state to exactly what it was before the most recent recorded turn, restoring per-player remaining scores, currentPlayerIndex, and any related flags (including needsDoubleConfirmation).",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-wire-the-new-core-game-state-into-the-existing-game-screen-in-a-minimal-non-flashy-way-so-it-is-ready-for-ui-usage-initialize-the-game-state-via-startgame-loadgamesettings-show-remaining-values-in-playercard-drive-the-active-player-highlight-from-currentplayerindex-and-replace-mock-turn-data-with-real-turn-history",
      "title": "Wire the new core game state into the existing /game screen in a minimal, non-flashy way so it is ready for UI usage: initialize the Game state via startGame(loadGameSettings()), show remaining values in PlayerCard, drive the active player highlight from currentPlayerIndex, and replace mock turn data with real turn history.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-keypad-flow-to-support-entering-a-scoredpoints-value-and-submitting-it-to-applyturn-scoredpoints-and-clearing-input-while-keeping-the-ui-touch-friendly-and-without-adding-new-visual-complexity",
      "title": "Update the keypad flow to support entering a scoredPoints value and submitting it to applyTurn(scoredPoints), and clearing input, while keeping the UI touch-friendly and without adding new visual complexity.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-game-score-entry-keypad-ui-to-include-quick-score-chips-for-the-following-values-26-41-45-60-85-100-121-140-180-tapping-a-chip-must-set-the-current-score-input-to-that-chip-value-replacing-any-existing-input-and-keep-the-value-capped-at-180",
      "title": "Update the /game score entry keypad UI to include quick score chips for the following values: 26, 41, 45, 60, 85, 100, 121, 140, 180. Tapping a chip must set the current score input to that chip value (replacing any existing input) and keep the value capped at 180.",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-rename-the-keypad-submit-action-to-use-the-user-facing-label-enter-and-ensure-the-enter-action-submits-the-current-input-as-scored-points-by-calling-applyturn-game-scoredpoints-on-successful-submit-it-must-clear-the-input-append-a-new-entry-to-turn-history-and-advance-the-current-player-highlight-according-to-the-updated-game-state-on-failure-show-an-english-error-message",
      "title": "Rename the keypad submit action to use the user-facing label \"Enter\" and ensure the Enter action submits the current input as scored points by calling applyTurn(game, scoredPoints). On successful submit, it must clear the input, append a new entry to turn history, and advance the current player highlight according to the updated game state; on failure, show an English error message.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-change-the-turn-history-display-on-game-to-show-only-the-last-5-turns-most-recent-5-while-preserving-the-existing-table-layout-and-empty-state-messaging",
      "title": "Change the turn history display on /game to show only the last 5 turns (most recent 5) while preserving the existing table layout and empty-state messaging.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-game-core-rules-to-support-finishing-a-leg-and-producing-a-game-over-state-rules-to-implement-if-double-out-is-off-and-a-turn-results-in-remaining-0-immediately-end-the-game-and-record-the-winner-if-double-out-is-on-and-a-turn-results-in-remaining-0-do-not-immediately-end-the-game-instead-mark-the-game-as-awaiting-double-finish-confirmation-so-the-ui-can-prompt-the-user-if-double-out-is-on-and-remaining-would-become-1-continue-treating-it-as-a-bust-the-game-core-state-must-expose-enough-information-for-the-ui-to-know-when-the-game-is-awaiting-double-confirmation-know-when-the-game-is-over-identify-the-winner-player-index-name-display-the-number-of-turns-taken-to-win",
      "title": "Update the game-core rules to support finishing a leg and producing a Game Over state.\n\nRules to implement:\n- If Double Out is OFF and a turn results in remaining == 0, immediately end the game and record the winner.\n- If Double Out is ON and a turn results in remaining == 0, do not immediately end the game; instead mark the game as awaiting double-finish confirmation so the UI can prompt the user.\n- If Double Out is ON and remaining would become 1, continue treating it as a bust.\n\nThe game-core state must expose enough information for the UI to:\n- Know when the game is awaiting double confirmation\n- Know when the game is over\n- Identify the winner (player index/name)\n- Display the number of turns taken to win",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-double-out-confirmation-prompt-in-the-game-ui-when-double-out-is-on-and-the-game-enters-the-awaiting-double-finish-confirmation-state-immediately-show-a-modal-prompt-with-the-exact-text-was-it-a-double-finish-the-prompt-must-provide-two-actions-yes-confirm-the-double-finish-and-complete-the-win-transition-to-game-over-no-treat-the-last-scoring-attempt-like-a-bust-by-reverting-the-effect-of-that-turn-restore-the-player-s-remaining-score-to-what-it-was-before-the-turn-and-continue-the-game-normally-while-awaiting-confirmation-prevent-further-score-entry-from-being-applied-until-the-user-chooses-yes-or-no",
      "title": "Implement the Double Out confirmation prompt in the /game UI.\n\nWhen Double Out is ON and the game enters the awaiting double-finish confirmation state, immediately show a modal/prompt with the exact text:\n\"Was it a double finish?\"\n\nThe prompt must provide two actions:\n- YES: confirm the double finish and complete the win (transition to Game Over)\n- NO: treat the last scoring attempt like a bust by reverting the effect of that turn (restore the player’s remaining score to what it was before the turn) and continue the game normally\n\nWhile awaiting confirmation, prevent further score entry from being applied until the user chooses YES or NO.",
      "reqIds": [
        "REQ-20"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-game-over-screen-in-the-frontend-that-appears-when-the-game-reaches-a-completed-win-state-the-game-over-screen-must-display-the-winner-player-name-the-number-of-turns-taken-the-game-over-screen-must-include-two-buttons-rematch-start-a-new-game-using-the-same-settings-as-the-finished-game-new-game-navigate-back-to-the-start-game-page-at-user-facing-text-on-this-screen-must-be-in-english",
      "title": "Add a Game Over screen in the frontend that appears when the game reaches a completed win state.\n\nThe Game Over screen must display:\n- The winner (player name)\n- The number of turns taken\n\nThe Game Over screen must include two buttons:\n- \"Rematch\" (start a new game using the same settings as the finished game)\n- \"New Game\" (navigate back to the Start Game page at /)\n\nUser-facing text on this screen must be in English.",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-persist-the-current-in-progress-game-state-to-localstorage-after-every-gameplay-state-change-so-the-game-can-be-restored-offline-later-this-must-include-saving-after-1-a-successful-score-entry-applyturn-2-undo-3-confirming-a-double-finish-yes-4-rejecting-a-double-finish-no-and-5-rematch-starting-a-new-game",
      "title": "Persist the current in-progress game state to localStorage after every gameplay state change so the game can be restored offline later. This must include saving after: (1) a successful score entry (applyTurn), (2) Undo, (3) confirming a double-finish (Yes), (4) rejecting a double-finish (No), and (5) Rematch starting a new game.",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-on-entering-the-game-route-if-a-saved-game-exists-in-localstorage-show-a-blocking-prompt-asking-whether-to-resume-it-the-prompt-must-show-the-exact-user-facing-title-text-resume-and-two-actions-resume-and-discard",
      "title": "On entering the /game route, if a saved game exists in localStorage, show a blocking prompt asking whether to resume it. The prompt must show the exact user-facing title text \"Resume?\" and two actions: \"Resume\" and \"Discard\".",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-saved-game-lifecycle-is-coherent-clear-the-persisted-saved-game-when-it-is-no-longer-resumable-or-no-longer-needed-and-keep-it-consistent-with-the-on-screen-state",
      "title": "Ensure saved-game lifecycle is coherent: clear the persisted saved game when it is no longer resumable or no longer needed, and keep it consistent with the on-screen state.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-an-offline-capable-pwa-service-worker-that-caches-the-app-shell-and-static-assets-so-that-after-the-first-successful-load-the-app-can-be-opened-and-used-without-internet-connectivity",
      "title": "Implement an offline-capable PWA service worker that caches the app shell and static assets so that after the first successful load, the app can be opened and used without internet connectivity.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-add-an-optional-voice-input-control-to-the-game-score-entry-ui-render-a-microphone-icon-button-inside-the-score-input-section-in-near-the-current-input-display-in-the-keypad-area-the-microphone-control-must-be-hidden-when-the-browser-does-not-support-the-web-speech-api-speechrecognition-interface",
      "title": "Add an optional voice input control to the /game Score Entry UI: render a microphone icon button inside the score input section (in/near the current input display in the Keypad area). The microphone control must be hidden when the browser does not support the Web Speech API SpeechRecognition interface.",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-voice-capture-using-the-web-speech-api-speechrecognition-when-the-user-taps-the-microphone-icon-start-listening-and-capture-a-transcript-string-convert-the-transcript-into-a-proposed-scored-points-integer-for-dart-entry",
      "title": "Implement voice capture using the Web Speech API (SpeechRecognition): when the user taps the microphone icon, start listening and capture a transcript string. Convert the transcript into a proposed scored-points integer for dart entry.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-transcript-to-number-parser-that-supports-common-spoken-english-score-phrases-including-at-minimum-one-forty-one-hundred-and-forty-sixty-and-one-eighty-the-parser-should-be-reasonably-robust-for-typical-darts-score-utterances-and-return-an-integer-or-a-parse-failure",
      "title": "Add a transcript-to-number parser that supports common spoken English score phrases, including at minimum: “one forty”, “one hundred and forty”, “sixty”, and “one eighty”. The parser should be reasonably robust for typical darts score utterances and return an integer or a parse failure.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-after-speech-recognition-completes-show-a-confirmation-ui-that-displays-1-the-raw-transcript-and-2-the-proposed-number-and-requires-explicit-user-confirmation-before-applying-it-to-the-score-input-provide-two-actions-ok-to-accept-and-edit-to-reject-adjust",
      "title": "After speech recognition completes, show a confirmation UI that displays (1) the raw transcript and (2) the proposed number, and requires explicit user confirmation before applying it to the score input. Provide two actions: “OK” to accept and “Edit” to reject/adjust.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-voice-input-respects-existing-gameplay-locks-when-the-game-is-in-the-awaiting-double-finish-confirmation-phase-prevent-voice-capture-and-confirmation-from-changing-the-score-input-or-applying-scores-the-microphone-control-should-be-disabled-or-hidden-during-this-phase",
      "title": "Ensure voice input respects existing gameplay locks: when the game is in the awaiting double-finish confirmation phase, prevent voice capture and confirmation from changing the score input or applying scores (the microphone control should be disabled or hidden during this phase).",
      "reqIds": [
        "REQ-30"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-score-entry-mode-switch-on-the-game-page-with-two-options-total-the-existing-numeric-keypad-flow-and-3-darts-new-per-dart-entry-flow",
      "title": "Add a score-entry mode switch on the `/game` page with two options: “Total” (the existing numeric keypad flow) and “3 Darts” (new per-dart entry flow).",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-3-darts-score-entry-ui-on-game-show-three-slots-dart-1-dart-2-dart-3-where-each-slot-may-be-empty-provide-a-shot-selection-panel-with-1-multiplier-toggle-s-d-t-2-a-1-20-value-button-grid-and-3-two-dedicated-buttons-outer-bull-25-and-bull-50-selecting-a-shot-must-fill-the-first-empty-dart-slot-provide-actions-clear-dart-remove-the-most-recently-filled-dart-clear-all-and-submit-turn",
      "title": "Implement the “3 Darts” score-entry UI on `/game`: show three slots (“Dart 1”, “Dart 2”, “Dart 3”) where each slot may be empty; provide a shot-selection panel with (1) multiplier toggle S / D / T, (2) a 1–20 value button grid, and (3) two dedicated buttons: “Outer Bull (25)” and “Bull (50)”. Selecting a shot must fill the first empty dart slot. Provide actions: “Clear Dart” (remove the most recently filled dart), “Clear All”, and “Submit Turn”.",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-frontend-game-core-data-model-to-support-per-dart-turns-by-expanding-the-turn-type-to-include-darts-array-mult-s-d-t-ob-b-value-number-turntotal-number-and-optional-finishdart-string-e-g-d20-keep-existing-turn-snapshot-data-needed-for-undo-intact-and-update-any-affected-code-that-consumes-turn-fields",
      "title": "Extend the frontend game core data model to support per-dart turns by expanding the Turn type to include: `darts: Array<{ mult: \"S\"|\"D\"|\"T\"|\"OB\"|\"B\", value: number }>`; `turnTotal: number`; and optional `finishDart?: string` (e.g., “D20”). Keep existing turn snapshot data needed for Undo intact and update any affected code that consumes Turn fields.",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-per-dart-turn-application-in-the-game-core-compute-each-dart-s-score-using-sx-x-dx-2x-tx-3x-outer-bull-25-bull-50-turn-total-is-the-sum-of-up-to-3-darts-missing-darts-count-as-0-apply-darts-sequentially-and-enforce-bust-rules-per-dart-if-remaining-becomes-0-at-any-dart-the-entire-turn-is-a-bust-if-double-out-is-on-and-remaining-would-become-1-at-any-point-the-entire-turn-is-a-bust-if-remaining-becomes-0-and-double-out-is-on-the-last-dart-must-be-a-double-d-or-bull-50-bull-counts-as-valid-double-out-or-else-the-entire-turn-is-a-bust-if-a-bust-occurs-mid-turn-the-entire-turn-is-annulled-and-play-advances-to-the-next-player-standard",
      "title": "Implement per-dart turn application in the game core: compute each dart’s score using Sx=x, Dx=2x, Tx=3x, Outer Bull=25, Bull=50; turn total is the sum of up to 3 darts (missing darts count as 0). Apply darts sequentially and enforce bust rules per dart: if remaining becomes < 0 at any dart, the entire turn is a BUST; if Double Out is ON and remaining would become 1 at any point, the entire turn is a BUST; if remaining becomes 0 and Double Out is ON, the last dart must be a Double (D) or Bull (50) (Bull counts as valid double-out) or else the entire turn is a BUST. If a bust occurs mid-turn, the entire turn is annulled and play advances to the next player (standard).",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-interactive-double-out-confirmation-flow-was-it-a-double-finish-and-replace-it-with-deterministic-double-out-behavior-the-game-must-not-enter-an-awaiting-confirmation-phase-and-must-not-show-the-doublefinishconfirmmodal-for-any-scoring-flow",
      "title": "Remove the interactive Double Out confirmation flow (“Was it a double finish?”) and replace it with deterministic Double Out behavior. The game must not enter an “awaiting-confirmation” phase and must not show the DoubleFinishConfirmModal for any scoring flow.",
      "reqIds": [
        "REQ-35"
      ],
      "version": 1
    },
    {
      "id": "feature-update-game-wiring-so-that-1-total-mode-continues-to-use-the-existing-keypad-component-and-submits-a-turn-via-the-existing-total-score-path-and-2-3-darts-mode-uses-the-new-per-dart-ui-and-submits-via-the-per-dart-game-core-function-ensure-localstorage-persistence-savegame-occurs-after-any-successful-submission-bust-submission-or-undo-and-that-the-saved-game-can-be-resumed-correctly",
      "title": "Update `/game` wiring so that: (1) “Total” mode continues to use the existing Keypad component and submits a turn via the existing total-score path, and (2) “3 Darts” mode uses the new per-dart UI and submits via the per-dart game-core function. Ensure localStorage persistence (saveGame) occurs after any successful submission, bust submission, or undo, and that the saved game can be resumed correctly.",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-update-turn-history-storage-and-rendering-so-that-each-turn-preserves-the-dart-notation-examples-t20-20-d20-ob-b-and-the-turn-history-ui-displays-rows-formatted-like-140-t20-t20-d20-for-a-normal-scoring-turn-and-bust-t20-20-for-a-bust-turn-show-the-darts-that-were-entered-empty-darts-may-be-omitted-or-shown-as-placeholders-but-must-remain-readable-keep-the-existing-table-layout-and-continue-to-display-only-the-most-recent-5-turns",
      "title": "Update turn history storage and rendering so that each turn preserves the dart notation (examples: “T20”, “20”, “D20”, “OB”, “B”) and the Turn History UI displays rows formatted like “-140 (T20 T20 D20)” for a normal scoring turn and “BUST (T20 20 …)” for a bust turn (show the darts that were entered; empty darts may be omitted or shown as placeholders but must remain readable). Keep the existing table layout and continue to display only the most recent 5 turns.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-make-saved-game-loading-robust-across-the-turn-schema-change-loading-an-older-saved-game-without-darts-turntotal-must-not-crash-the-app-when-an-old-turn-record-is-encountered-gracefully-default-missing-fields-e-g-darts-turntotal-scoredpoints-so-that-resume-and-turn-history-rendering-continue-to-function",
      "title": "Make saved-game loading robust across the Turn schema change: loading an older saved game (without `darts` / `turnTotal`) must not crash the app. When an old turn record is encountered, gracefully default missing fields (e.g., `darts: []`, `turnTotal: scoredPoints`) so that resume and Turn History rendering continue to function.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-add-an-optional-checkout-helper-ui-toggle-on-the-game-page-when-enabled-and-the-current-player-s-remaining-score-is-170-show-1-3-suggested-checkout-routes-for-that-remaining-score-using-a-simple-rules-table-covering-common-popular-checkouts-it-does-not-need-to-be-complete-if-double-out-is-on-every-suggested-route-must-end-on-a-double-or-bull",
      "title": "Add an optional “Checkout Helper” UI toggle on the /game page. When enabled and the current player’s remaining score is <= 170, show 1–3 suggested checkout routes for that remaining score using a simple rules table covering common/popular checkouts (it does not need to be complete). If Double Out is ON, every suggested route must end on a double or bull.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-small-frontend-only-checkout-suggestion-engine-data-function-that-returns-up-to-3-suggested-checkout-routes-for-a-given-remaining-score-170-and-a-double-out-flag-the-engine-must-prioritize-common-popular-finishes-and-be-deterministic-same-input-same-suggestions",
      "title": "Implement a small, frontend-only checkout suggestion engine (data + function) that returns up to 3 suggested checkout routes for a given remaining score (<=170) and a Double Out flag. The engine must prioritize common/popular finishes and be deterministic (same input => same suggestions).",
      "reqIds": [
        "REQ-40"
      ],
      "version": 1
    },
    {
      "id": "feature-add-per-game-player-statistics-computed-from-the-current-in-memory-game-state-and-compatible-with-the-persisted-saved-game-average-per-3-darts-avg-optional-first-9-average-number-of-180s-checkout-percentage-only-when-double-out-is-on-and-number-of-busts",
      "title": "Add per-game player statistics computed from the current in-memory game state (and compatible with the persisted saved game): average per 3 darts (avg), optional first 9 average, number of 180s, checkout percentage (only when Double Out is ON), and number of busts.",
      "reqIds": [
        "REQ-41"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-dedicated-stats-screen-that-shows-a-table-of-all-players-and-the-computed-per-game-metrics-avg-optional-first-9-avg-180s-checkout-when-double-out-on-busts-make-it-accessible-via-a-stats-button-during-gameplay-and-after-game-over",
      "title": "Create a dedicated “Stats” screen that shows a table of all players and the computed per-game metrics (avg, optional first 9 avg, 180s, checkout % when Double Out ON, busts). Make it accessible via a “Stats” button during gameplay and after Game Over.",
      "reqIds": [
        "REQ-42"
      ],
      "version": 1
    },
    {
      "id": "feature-wire-the-stats-screen-to-the-existing-localstorage-game-persistence-so-that-the-stats-screen-can-display-stats-for-the-current-game-both-during-play-and-after-game-over-including-when-navigated-to-directly-after-reload",
      "title": "Wire the Stats screen to the existing localStorage game persistence so that the Stats screen can display stats for the current game both during play and after Game Over (including when navigated to directly after reload).",
      "reqIds": [
        "REQ-43"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-persisted-cameras-configuration-up-to-3-camera-slots-stored-in-localstorage-supporting-per-slot-source-type-selection-webcam-via-getusermedia-or-hls-url-e-g-https-stream-m3u8",
      "title": "Add a persisted Cameras configuration (up to 3 camera slots) stored in localStorage, supporting per-slot source type selection: Webcam (via getUserMedia) or HLS URL (e.g., https://.../stream.m3u8).",
      "reqIds": [
        "REQ-44"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-an-hls-test-action-for-each-hls-camera-slot-that-validates-the-provided-hls-url-and-shows-an-in-ui-success-failure-result-in-english-without-crashing-the-app",
      "title": "Implement an HLS “Test” action for each HLS camera slot that validates the provided HLS URL and shows an in-UI success/failure result in English without crashing the app.",
      "reqIds": [
        "REQ-45"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-cameras-panel-to-the-game-screen-that-renders-up-to-3-live-previews-based-on-the-saved-camera-configuration-with-responsive-layouts-for-1-2-and-3-cameras",
      "title": "Add a Cameras panel to the /game screen that renders up to 3 live previews based on the saved camera configuration, with responsive layouts for 1, 2, and 3 cameras.",
      "reqIds": [
        "REQ-46"
      ],
      "version": 1
    },
    {
      "id": "feature-add-per-preview-controls-in-the-game-camera-panel-mute-pause-preview-only-swap-order-and-fullscreen-for-a-selected-preview",
      "title": "Add per-preview controls in the /game camera panel: mute, pause (preview-only), swap order, and fullscreen for a selected preview.",
      "reqIds": [
        "REQ-47"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-webcam-preview-support-using-getusermedia-including-permission-handling-and-a-clear-english-error-state-when-permissions-are-denied-or-no-device-is-available",
      "title": "Implement Webcam preview support using getUserMedia, including permission handling and a clear English error state when permissions are denied or no device is available.",
      "reqIds": [
        "REQ-48"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-hls-preview-support-for-configured-hls-urls-using-an-in-browser-approach-native-hls-where-available-otherwise-a-js-based-hls-playback-solution-without-requiring-any-backend-proxy-in-this-mvp",
      "title": "Implement HLS preview support for configured HLS URLs using an in-browser approach (native HLS where available; otherwise a JS-based HLS playback solution), without requiring any backend proxy in this MVP.",
      "reqIds": [
        "REQ-49"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-review-action-next-to-the-turn-history-section-on-game-that-opens-a-modal-for-reviewing-the-most-recent-turn-including-camera-thumbnails-and-last-turn-details",
      "title": "Add a “Review” action next to the Turn History section on /game that opens a modal for reviewing the most recent turn, including camera thumbnails and last-turn details.",
      "reqIds": [
        "REQ-50"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-edit-turn-for-the-last-recorded-turn-allowing-edits-appropriate-to-how-the-turn-was-entered-total-mode-vs-3-darts-mode-using-english-ui-text",
      "title": "Implement “Edit turn” for the last recorded turn, allowing edits appropriate to how the turn was entered (Total mode vs 3 Darts mode), using English UI text.",
      "reqIds": [
        "REQ-51"
      ],
      "version": 1
    },
    {
      "id": "feature-after-saving-an-edited-last-turn-recompute-replay-the-game-state-deterministically-from-the-start-of-the-game-using-the-game-settings-and-the-turn-list-with-the-edited-last-turn-applied-ensuring-player-remaining-values-currentplayerindex-game-phase-in-progress-game-over-winner-and-turn-history-are-all-consistent",
      "title": "After saving an edited last turn, recompute (“replay”) the game state deterministically from the start of the game using the game settings and the turn list with the edited last turn applied, ensuring player remaining values, currentPlayerIndex, game phase (in-progress/game-over), winner, and Turn History are all consistent.",
      "reqIds": [
        "REQ-52"
      ],
      "version": 1
    },
    {
      "id": "feature-extend-the-frontend-game-data-model-and-persistence-to-include-a-shotevent-log-and-generate-shotevents-for-manual-and-voice-inputs-as-confirmed-events-linked-to-the-created-edited-turn",
      "title": "Extend the frontend game data model and persistence to include a ShotEvent log, and generate ShotEvents for manual and voice inputs as “confirmed” events linked to the created/edited turn.",
      "reqIds": [
        "REQ-53"
      ],
      "version": 1
    },
    {
      "id": "feature-design-and-add-a-frontend-scoringprovider-interface-with-start-stop-and-onproposal-callback-that-emits-proposed-shotevents-implement-an-mvp-stub-provider-that-emits-nothing-but-can-be-wired-into-the-ui-later-without-refactoring-the-core-data-structures",
      "title": "Design and add a frontend ScoringProvider interface with start(), stop(), and onProposal(callback) that emits proposed ShotEvents; implement an MVP stub provider that emits nothing but can be wired into the UI later without refactoring the core data structures.",
      "reqIds": [
        "REQ-54"
      ],
      "version": 1
    },
    {
      "id": "feature-expose-two-realtime-endpoints-channels-matching-the-requested-paths-ws-ws-rooms-code-and-ws-ws-games-game-id-define-and-document-the-event-envelope-format-as-json-with-type-and-payload-fields-so-the-frontend-can-parse-it-consistently",
      "title": "Expose two realtime endpoints/channels matching the requested paths: `WS /ws/rooms/{code}` and `WS /ws/games/{game_id}`. Define and document the event envelope format as JSON with `type` and `payload` fields so the frontend can parse it consistently.",
      "reqIds": [
        "REQ-80"
      ],
      "version": 1
    },
    {
      "id": "feature-add-frontend-realtime-client-wiring-that-connects-to-ws-games-game-id-for-the-currently-active-game-and-updates-the-in-memory-ui-state-using-incoming-type-game-snapshot-events-the-frontend-must-treat-snapshots-as-authoritative-and-overwrite-refresh-the-displayed-game-state-accordingly",
      "title": "Add frontend realtime client wiring that connects to `ws/games/{game_id}` for the currently active game and updates the in-memory UI state using incoming `{ type: \"GAME_SNAPSHOT\" }` events. The frontend must treat snapshots as authoritative and overwrite/refresh the displayed game state accordingly.",
      "reqIds": [
        "REQ-83"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-new-start-screen-flow-for-multi-device-play-that-supports-creating-and-joining-a-room-create-room-action-that-calls-backend-equivalent-to-post-rooms-and-then-displays-the-returned-room-code-join-room-flow-where-the-user-enters-a-room-code-and-the-app-calls-backend-equivalent-to-get-rooms-code-to-validate-fetch-the-room-all-user-facing-text-must-be-in-english",
      "title": "Add a new Start screen flow for multi-device play that supports creating and joining a room:\n- “Create Room” action that calls backend (equivalent to POST /rooms) and then displays the returned room code.\n- “Join Room” flow where the user enters a room code and the app calls backend (equivalent to GET /rooms/{code}) to validate/fetch the room.\nAll user-facing text must be in English.",
      "reqIds": [
        "REQ-84"
      ],
      "version": 1
    },
    {
      "id": "feature-introduce-dedicated-routes-pages-for-multi-device-roles-within-a-room-a-host-scorer-screen-for-creating-a-game-and-entering-scores-a-display-tv-screen-that-is-read-only-and-shows-the-scoreboard-recent-turns-ensure-navigation-from-the-multi-device-start-screen-to-these-pages-is-clear-and-uses-english-ui-text",
      "title": "Introduce dedicated routes/pages for multi-device roles within a room:\n- A “Host / Scorer” screen for creating a game and entering scores.\n- A “Display / TV” screen that is read-only and shows the scoreboard + recent turns.\nEnsure navigation from the multi-device Start screen to these pages is clear and uses English UI text.",
      "reqIds": [
        "REQ-85"
      ],
      "version": 1
    },
    {
      "id": "feature-on-the-host-scorer-screen-implement-game-creation-in-a-room-by-calling-backend-equivalent-to-post-rooms-code-games-using-the-existing-game-settings-301-501-double-out-players-and-then-transition-the-host-scorer-ui-into-live-scoring-mode-for-that-created-game",
      "title": "On the Host / Scorer screen, implement game creation in a room by calling backend (equivalent to POST /rooms/{code}/games) using the existing game settings (301/501, Double Out, players) and then transition the Host / Scorer UI into “live scoring” mode for that created game.",
      "reqIds": [
        "REQ-87"
      ],
      "version": 1
    },
    {
      "id": "feature-wire-host-scorer-gameplay-mutations-to-backend-methods-score-entry-calls-backend-equivalent-to-post-turns-or-post-games-game-id-turns-depending-on-backend-api-shape-undo-calls-backend-equivalent-to-post-undo-or-post-games-game-id-undo-edit-last-turn-calls-backend-equivalent-to-put-turns-turn-id-after-each-successful-mutation-the-ui-must-refresh-from-the-returned-authoritative-game-snapshot",
      "title": "Wire Host / Scorer gameplay mutations to backend methods:\n- Score entry calls backend (equivalent to POST /turns or POST /games/{game_id}/turns depending on backend API shape).\n- Undo calls backend (equivalent to POST /undo or POST /games/{game_id}/undo).\n- Edit last turn calls backend (equivalent to PUT /turns/{turn_id}).\nAfter each successful mutation, the UI must refresh from the returned authoritative game snapshot.",
      "reqIds": [
        "REQ-88"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-display-tv-screen-as-a-read-only-view-that-shows-the-scoreboard-players-remaining-active-indicator-and-the-most-recent-turns-connects-to-the-realtime-channel-ws-ws-games-game-id-and-renders-authoritative-type-game-snapshot-payload-updates-does-not-allow-score-entry-undo-or-edits",
      "title": "Implement the Display / TV screen as a read-only view that:\n- Shows the scoreboard (players + remaining + active indicator) and the most recent turns.\n- Connects to the realtime channel `WS /ws/games/{game_id}` and renders authoritative `{ type: \"GAME_SNAPSHOT\", payload: ... }` updates.\n- Does not allow score entry, undo, or edits.",
      "reqIds": [
        "REQ-89"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-multi-device-parallel-usage-works-coherently-when-the-host-scorer-performs-a-mutation-new-turn-undo-edit-the-backend-broadcasts-a-game-snapshot-event-to-connected-display-tv-clients-so-they-update-without-manual-refresh",
      "title": "Ensure multi-device parallel usage works coherently: when the Host / Scorer performs a mutation (new turn / undo / edit), the backend broadcasts a `GAME_SNAPSHOT` event to connected Display / TV clients so they update without manual refresh.",
      "reqIds": [
        "REQ-90"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-multi-device-create-room-flow-to-capture-and-persist-the-returned-scorer-admin-token-for-the-created-room-e-g-in-localstorage-keyed-by-room-code-and-use-it-automatically-for-host-scorer-actions-on-that-device",
      "title": "Update the frontend multi-device Create Room flow to capture and persist the returned scorer/admin token for the created room (e.g., in localStorage keyed by room code) and use it automatically for Host / Scorer actions on that device.",
      "reqIds": [
        "REQ-94"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-minimal-frontend-ui-for-the-host-scorer-role-to-handle-scorer-admin-tokens-across-devices-allow-the-user-to-enter-a-scorer-token-when-joining-a-room-or-when-opening-host-scorer-without-a-saved-token-persist-it-locally-for-that-room-code-and-clearly-show-an-english-error-state-when-the-token-is-invalid",
      "title": "Add a minimal frontend UI for the Host / Scorer role to handle scorer/admin tokens across devices: allow the user to enter a scorer token when joining a room (or when opening Host / Scorer without a saved token), persist it locally for that room code, and clearly show an English error state when the token is invalid.",
      "reqIds": [
        "REQ-95"
      ],
      "version": 1
    },
    {
      "id": "feature-plumb-the-admin-token-through-existing-frontend-api-helper-functions-used-by-the-host-scorer-screen-e-g-functions-in-frontend-src-lib-roomgameapi-ts-and-frontend-src-lib-roomsapi-ts-so-that-all-state-mutating-actor-calls-include-the-token-parameter-while-read-only-calls-remain-unchanged",
      "title": "Plumb the admin token through existing frontend API helper functions used by the Host / Scorer screen (e.g., functions in `frontend/src/lib/roomGameApi.ts` and `frontend/src/lib/roomsApi.ts`) so that all state-mutating actor calls include the token parameter, while read-only calls remain unchanged.",
      "reqIds": [
        "REQ-96"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-deployment-guide-in-english-describing-how-to-run-the-app-in-both-development-and-production-on-the-internet-computer-toolchain-not-docker-including-prerequisites-local-dev-steps-production-deploy-steps-how-to-verify-the-backend-health-check-and-how-to-build-serve-the-frontend-assets",
      "title": "Create a deployment guide in English describing how to run the app in both development and production on the Internet Computer toolchain (not Docker), including: prerequisites, local dev steps, production deploy steps, how to verify the backend health check, and how to build/serve the frontend assets.",
      "reqIds": [
        "REQ-98"
      ],
      "version": 1
    },
    {
      "id": "feature-document-and-implement-an-environment-configuration-approach-compatible-with-internet-computer-deployments-no-docker-env-for-the-canister-clearly-list-all-configuration-values-needed-by-the-app-and-where-they-are-set-for-a-frontend-build-runtime-and-b-backend-canister-initialization-upgrade-using-safe-defaults-so-the-project-runs-out-of-the-box",
      "title": "Document and implement an environment-configuration approach compatible with Internet Computer deployments (no Docker `.env` for the canister). Clearly list all configuration values needed by the app and where they are set for (a) frontend build/runtime and (b) backend canister initialization/upgrade, using safe defaults so the project runs out-of-the-box.",
      "reqIds": [
        "REQ-99"
      ],
      "version": 1
    },
    {
      "id": "feature-provide-an-optional-reverse-proxy-configuration-example-caddy-or-nginx-and-guidance-so-the-application-works-correctly-behind-a-proxy-the-guidance-must-cover-forwarding-headers-serving-the-frontend-and-proxying-requests-to-the-ic-boundary-gateway-urls-without-breaking-routing-or-pwa-assets",
      "title": "Provide an optional reverse-proxy configuration example (Caddy or Nginx) and guidance so the application works correctly behind a proxy. The guidance must cover: forwarding headers, serving the frontend, and proxying requests to the IC boundary/gateway URLs without breaking routing or PWA assets.",
      "reqIds": [
        "REQ-100"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-snapshot-type-definitions-to-match-the-newly-defined-canonical-backend-snapshot-schema-and-adjust-realtime-event-typing-accordingly-align-frontend-src-lib-realtimeeventenvelope-ts-so-that-the-game-snapshot-payload-matches-the-backend-s-game-players-last-turns-shot-events-last-structure-and-can-be-consumed-consistently-by-host-scorer-and-display-tv-screens",
      "title": "Update the frontend snapshot type definitions to match the newly defined canonical backend snapshot schema, and adjust realtime event typing accordingly. Align `frontend/src/lib/realtimeEventEnvelope.ts` so that the `GAME_SNAPSHOT` payload matches the backend’s `game/players/last_turns/shot_events_last` structure and can be consumed consistently by Host/Scorer and Display/TV screens.",
      "reqIds": [
        "REQ-102"
      ],
      "version": 1
    },
    {
      "id": "feature-refactor-multi-device-ui-code-paths-to-consume-the-canonical-snapshot-shape-no-additional-fetches-required-update-the-display-tv-scoreboard-and-recent-turns-components-pages-to-read-from-snapshot-game-snapshot-players-and-snapshot-last-turns-update-host-scorer-api-helper-s-to-stop-constructing-mock-snapshots-and-instead-use-the-backend-returned-snapshot-as-the-source-of-truth",
      "title": "Refactor multi-device UI code paths to consume the canonical snapshot shape (no additional fetches required). Update the Display/TV scoreboard and recent turns components/pages to read from `snapshot.game`, `snapshot.players`, and `snapshot.last_turns`. Update Host/Scorer API helper(s) to stop constructing “mock” snapshots and instead use the backend-returned snapshot as the source of truth.",
      "reqIds": [
        "REQ-103"
      ],
      "version": 1
    },
    {
      "id": "feature-add-developer-facing-documentation-for-the-snapshot-api-contract-in-english-including-field-names-types-and-semantics-and-explicitly-state-that-the-frontend-should-be-able-to-render-from-the-snapshot-without-extra-requests-document-how-the-snapshot-is-carried-over-realtime-events-type-game-snapshot-payload-snapshot",
      "title": "Add developer-facing documentation for the snapshot API contract in English, including field names, types, and semantics, and explicitly state that the frontend should be able to render from the snapshot without extra requests. Document how the snapshot is carried over realtime events (`{ type: \"GAME_SNAPSHOT\", payload: <snapshot> }`).",
      "reqIds": [
        "REQ-104"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-minimal-frontend-account-ui-using-the-existing-internet-identity-integration-provide-a-sign-in-button-that-triggers-internet-identity-login-a-sign-out-button-that-clears-the-identity-and-a-simple-my-account-view-that-displays-the-current-user-profile-email-username-from-the-backend-me-equivalent-method-if-the-user-is-logged-in-via-internet-identity-but-has-no-backend-profile-yet-prompt-them-to-create-one-username-optional-email-with-english-validation-errors",
      "title": "Add a minimal frontend account UI using the existing Internet Identity integration: provide a sign-in button that triggers Internet Identity login, a sign-out button that clears the identity, and a simple “My Account” view that displays the current user profile (email, username) from the backend `me`-equivalent method. If the user is logged in via Internet Identity but has no backend profile yet, prompt them to create one (username + optional email) with English validation errors.",
      "reqIds": [
        "REQ-107"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-canonical-snapshot-types-consumed-by-the-multi-device-frontend-so-each-player-includes-the-new-linking-fields-user-id-nullable-and-display-name-while-keeping-backward-compatibility-for-existing-ui-usages-that-rely-on-name-ensure-the-frontend-prefers-showing-display-name-when-present-for-all-player-name-rendering-in-multi-device-screens-host-scorer-and-display-tv",
      "title": "Update the canonical snapshot/types consumed by the multi-device frontend so each player includes the new linking fields (`user_id` nullable and `display_name`) while keeping backward compatibility for existing UI usages that rely on `name`. Ensure the frontend prefers showing `display_name` when present for all player name rendering in multi-device screens (Host/Scorer and Display/TV).",
      "reqIds": [
        "REQ-111"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-minimal-touch-friendly-frontend-ui-on-the-host-scorer-game-creation-flow-to-optionally-assign-each-player-seat-to-either-guest-or-the-currently-signed-in-user-if-available-if-the-browser-is-not-signed-in-or-no-profile-exists-only-guest-assignment-is-available-use-english-labels",
      "title": "Add a minimal, touch-friendly frontend UI on the Host/Scorer game creation flow to optionally assign each player seat to either Guest or the currently signed-in user (if available). If the browser is not signed in or no profile exists, only Guest assignment is available. Use English labels.",
      "reqIds": [
        "REQ-112"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-minimal-frontend-flow-for-a-logged-in-user-to-claim-a-seat-using-the-backend-claim-method-equivalent-to-post-games-game-id-players-player-id-claim-the-ui-must-show-clear-english-success-error-feedback-the-claim-action-must-be-disabled-hidden-when-the-user-is-not-authenticated",
      "title": "Add a minimal frontend flow for a logged-in user to claim a seat using the backend claim method (equivalent to `POST /games/{game_id}/players/{player_id}/claim`). The UI must show clear English success/error feedback. The claim action must be disabled/hidden when the user is not authenticated.",
      "reqIds": [
        "REQ-113"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-multi-device-room-apis-and-pages-to-align-with-the-new-authorization-model-allow-host-scorer-mutations-to-succeed-either-via-stored-admin-token-or-by-being-the-authenticated-room-owner-and-ensure-read-only-room-game-fetches-remain-tokenless",
      "title": "Update the frontend multi-device room APIs and pages to align with the new authorization model: allow host/scorer mutations to succeed either via stored admin token OR by being the authenticated room owner, and ensure read-only room/game fetches remain tokenless.",
      "reqIds": [
        "REQ-135"
      ],
      "version": 1
    },
    {
      "id": "feature-add-new-tanstack-router-routes-to-match-the-requested-paths-without-removing-existing-routes-implement-login-register-profile-and-games-id-game-details-keep-the-existing-account-route-working-but-add-navigation-so-the-header-and-in-app-links-prefer-the-new-profile-route-for-authenticated-users",
      "title": "Add new TanStack Router routes to match the requested paths, without removing existing routes: implement `/login`, `/register`, `/profile`, and `/games/$id` (game details). Keep the existing `/account` route working, but add navigation so the header and in-app links prefer the new `/profile` route for authenticated users.",
      "reqIds": [
        "REQ-137"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-login-page-ui-using-the-existing-internet-identity-authentication-integration-show-a-primary-sign-in-action-triggers-internet-identity-login-and-when-already-authenticated-redirect-or-offer-a-clear-navigation-action-to-profile-all-user-facing-text-must-be-in-english",
      "title": "Implement `/login` page UI using the existing Internet Identity authentication integration: show a primary \"Sign in\" action (triggers Internet Identity login) and, when already authenticated, redirect or offer a clear navigation action to `/profile`. All user-facing text must be in English.",
      "reqIds": [
        "REQ-138"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-register-page-ui-for-authenticated-users-who-do-not-yet-have-a-backend-profile-provide-a-form-to-set-username-required-and-email-optional-submit-via-the-existing-backend-register-email-username-actor-method-and-on-success-navigate-to-profile-if-the-user-is-not-authenticated-show-an-english-message-instructing-them-to-sign-in-first-and-provide-a-button-to-go-to-login",
      "title": "Implement `/register` page UI for authenticated users who do not yet have a backend profile: provide a form to set \"Username\" (required) and \"Email\" (optional), submit via the existing backend `register(email, username)` actor method, and on success navigate to `/profile`. If the user is not authenticated, show an English message instructing them to sign in first and provide a button to go to `/login`.",
      "reqIds": [
        "REQ-139"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-profile-page-that-displays-1-the-current-user-s-profile-at-minimum-username-email-if-available-and-2-the-user-s-aggregated-statistics-using-the-existing-stats-hook-usemystats-provide-a-sign-out-action-if-the-user-is-authenticated-but-has-no-profile-yet-redirect-or-guide-them-to-register-with-an-english-explanation",
      "title": "Implement `/profile` page that displays: (1) the current user’s profile (at minimum: username; email if available) and (2) the user’s aggregated statistics using the existing stats hook (`useMyStats`). Provide a \"Sign out\" action. If the user is authenticated but has no profile yet, redirect or guide them to `/register` with an English explanation.",
      "reqIds": [
        "REQ-140"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-backend-me-equivalent-query-method-that-returns-the-caller-s-user-profile-username-email-etc-as-an-option-result-style-response-non-trapping-for-expected-cases-update-frontend-profile-related-screens-to-use-this-method-to-determine-whether-a-profile-exists-instead-of-relying-on-the-current-attempt-to-register-and-infer-workaround",
      "title": "Add a backend `me`-equivalent query method that returns the caller’s user profile (username/email/etc.) as an `Option`/Result-style response (non-trapping for expected cases). Update frontend profile-related screens to use this method to determine whether a profile exists, instead of relying on the current \"attempt to register and infer\" workaround.",
      "reqIds": [
        "REQ-141"
      ],
      "version": 1
    },
    {
      "id": "feature-enhance-history-existing-gamehistorypage-to-support-filters-for-the-user-s-game-list-1-mode-filter-301-501-or-all-2-date-range-filter-from-to-and-3-pagination-remains-functional-wire-filters-to-the-existing-useusergamehistory-userid-mode-from-to-limit-offset-hook-reset-pagination-offset-to-0-when-filters-change-and-keep-all-user-facing-text-in-english",
      "title": "Enhance `/history` (existing GameHistoryPage) to support filters for the user’s game list: (1) mode filter (301/501 or All), (2) date range filter (From / To), and (3) pagination remains functional. Wire filters to the existing `useUserGameHistory(userId, { mode, from, to, limit, offset })` hook, reset pagination offset to 0 when filters change, and keep all user-facing text in English.",
      "reqIds": [
        "REQ-142"
      ],
      "version": 1
    },
    {
      "id": "feature-make-each-row-in-history-navigable-to-games-id-for-that-game-e-g-row-click-or-a-details-button-implement-games-id-page-to-show-a-minimal-match-detail-view-game-metadata-mode-double-out-started-finished-timestamps-if-available-and-a-turns-list-using-the-existing-usegameturns-gameid-limit-offset-hook-with-pagination-defer-charts-heatmaps-to-a-later-iteration",
      "title": "Make each row in `/history` navigable to `/games/$id` for that game (e.g., row click or a \"Details\" button). Implement `/games/$id` page to show a minimal match detail view: game metadata (mode, double out, started/finished timestamps if available) and a turns list using the existing `useGameTurns(gameId, limit, offset)` hook with pagination. Defer charts/heatmaps to a later iteration.",
      "reqIds": [
        "REQ-143"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-an-authentication-session-handling-abstraction-on-the-frontend-that-is-compatible-with-the-current-internet-identity-flow-but-can-accommodate-the-requested-token-approach-later-keep-any-access-credential-in-memory-only-no-localstorage-persistence-and-centralize-session-refresh-logic-behind-a-single-interface-add-clear-code-comments-documenting-that-refresh-token-in-httponly-cookie-is-a-future-option-only-if-when-a-non-internet-identity-token-backend-is-introduced",
      "title": "Implement an authentication/session handling abstraction on the frontend that is compatible with the current Internet Identity flow but can accommodate the requested token approach later: keep any access credential in memory only (no localStorage persistence), and centralize \"session refresh\" logic behind a single interface. Add clear code comments documenting that \"refresh token in httpOnly cookie\" is a future option only if/when a non-Internet-Identity token backend is introduced.",
      "reqIds": [
        "REQ-144"
      ],
      "version": 1
    },
    {
      "id": "feature-document-how-to-configure-the-four-google-oauth-values-for-local-development-and-production-including-where-and-how-a-developer-should-set-them-and-list-the-dev-defaults-documentation-must-explicitly-state-that-existing-authentication-settings-are-unchanged-by-this-configuration-step",
      "title": "Document how to configure the four Google OAuth values for local development and production, including where and how a developer should set them, and list the dev defaults. Documentation must explicitly state that existing authentication settings are unchanged by this configuration step.",
      "reqIds": [
        "REQ-151"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-secondary-sign-in-option-on-the-login-page-a-button-labeled-exactly-continue-with-google-that-when-clicked-navigates-the-browser-to-the-backend-endpoint-auth-google-start-full-page-redirect",
      "title": "Add a secondary sign-in option on the `/login` page: a button labeled exactly \"Continue with Google\" that, when clicked, navigates the browser to the backend endpoint `/auth/google/start` (full-page redirect).",
      "reqIds": [
        "REQ-168"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-frontend-route-page-that-serves-as-frontend-oauth-redirect-and-handles-the-google-oauth-return-by-reading-token-or-error-from-the-url-query-string-storing-the-token-using-the-same-session-mechanism-used-by-the-app-s-normal-login-then-redirecting-the-user-to-profile-or-the-app-s-dashboard-destination",
      "title": "Implement a frontend route/page that serves as `FRONTEND_OAUTH_REDIRECT` and handles the Google OAuth return by reading `token` (or `error`) from the URL query string, storing the token using the same session mechanism used by the app’s normal login, then redirecting the user to `/profile` (or the app’s dashboard destination).",
      "reqIds": [
        "REQ-169"
      ],
      "version": 1
    },
    {
      "id": "feature-add-error-handling-for-the-google-oauth-redirect-page-for-a-missing-token-and-b-user-consent-denial-showing-clear-english-messages-and-a-recovery-action-back-to-login",
      "title": "Add error handling for the Google OAuth redirect page for (a) missing token and (b) user consent denial, showing clear English messages and a recovery action back to `/login`.",
      "reqIds": [
        "REQ-170"
      ],
      "version": 1
    },
    {
      "id": "feature-wrap-the-entire-react-app-at-the-highest-possible-level-above-all-routes-pages-layouts-in-oauthtokensessionprovider-so-that-any-component-calling-useoauthtokensession-usesession-never-renders-outside-the-provider-because-frontend-src-main-tsx-is-immutable-implement-this-wrapping-in-a-non-immutable-root-such-as-frontend-src-app-tsx-by-wrapping-the-existing-routerprovider",
      "title": "Wrap the entire React app (at the highest possible level above all routes/pages/layouts) in `<OAuthTokenSessionProvider>` so that any component calling `useOAuthTokenSession`/`useSession` never renders outside the provider. Because `frontend/src/main.tsx` is immutable, implement this wrapping in a non-immutable root such as `frontend/src/App.tsx` by wrapping the existing `<RouterProvider />`.",
      "reqIds": [
        "REQ-175"
      ],
      "version": 1
    },
    {
      "id": "feature-change-useoauthtokensession-so-it-never-throws-when-used-outside-a-provider-if-the-context-is-missing-return-a-safe-unauthenticated-null-session-value-e-g-googleaccesstoken-null-setgoogleaccesstoken-no-op-cleargoogleaccesstoken-no-op-instead-of-throwing-an-exception",
      "title": "Change `useOAuthTokenSession` so it never throws when used outside a provider. If the context is missing, return a safe unauthenticated/null session value (e.g., `{ googleAccessToken: null, setGoogleAccessToken: no-op, clearGoogleAccessToken: no-op }`) instead of throwing an exception.",
      "reqIds": [
        "REQ-176"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-continue-with-google-action-on-the-login-page-so-clicking-it-performs-a-full-page-redirect-to-the-backend-oauth-start-endpoint-using-window-location-href-backend-base-url-auth-google-start-where-backend-base-url-is-read-from-the-environment-variable-next-public-backend-url-do-not-use-tanstack-router-navigation-link-or-any-in-app-routing-for-this-action",
      "title": "Update the “Continue with Google” action on the `/login` page so clicking it performs a full-page redirect to the backend OAuth start endpoint using `window.location.href = BACKEND_BASE_URL + \"/auth/google/start\"`, where `BACKEND_BASE_URL` is read from the environment variable `NEXT_PUBLIC_BACKEND_URL`. Do not use TanStack Router navigation, `<Link>`, or any in-app routing for this action.",
      "reqIds": [
        "REQ-178"
      ],
      "version": 1
    },
    {
      "id": "feature-if-next-public-backend-url-is-missing-empty-at-runtime-prevent-any-redirect-and-instead-show-an-in-ui-message-google-login-not-configured-english-exact-text",
      "title": "If `NEXT_PUBLIC_BACKEND_URL` is missing/empty at runtime, prevent any redirect and instead show an in-UI message: \"Google login not configured\" (English, exact text).",
      "reqIds": [
        "REQ-179"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-frontend-never-renders-an-in-app-route-page-at-auth-google-and-does-not-navigate-to-auth-google-for-google-sign-in",
      "title": "Ensure the frontend never renders an in-app route/page at `/auth/google` (and does not navigate to `/auth/google` for Google sign-in).",
      "reqIds": [
        "REQ-180"
      ],
      "version": 1
    },
    {
      "id": "feature-document-the-new-frontend-environment-variable-next-public-backend-url-example-https-dart-scoring-backend-caffeine-xyz-in-frontend-docs-configuration-md-including-what-it-controls-google-oauth-backend-base-url-and-what-happens-when-it-is-not-set-shows-google-login-not-configured",
      "title": "Document the new frontend environment variable `NEXT_PUBLIC_BACKEND_URL` (example: `https://dart-scoring-backend.caffeine.xyz`) in `frontend/docs/configuration.md`, including what it controls (Google OAuth backend base URL) and what happens when it is not set (shows \"Google login not configured\").",
      "reqIds": [
        "REQ-181"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-frontend-build-runtime-exposes-the-environment-variable-next-public-backend-url-so-that-import-meta-env-next-public-backend-url-is-populated-when-the-variable-is-set-during-build-deploy",
      "title": "Ensure the frontend build/runtime exposes the environment variable `NEXT_PUBLIC_BACKEND_URL` so that `import.meta.env.NEXT_PUBLIC_BACKEND_URL` is populated when the variable is set during build/deploy.",
      "reqIds": [
        "REQ-182"
      ],
      "version": 1
    },
    {
      "id": "feature-on-the-login-page-ensure-clicking-the-button-labeled-exactly-continue-with-google-performs-a-full-page-redirect-using-window-location-href-next-public-backend-url-auth-google-start-with-safe-trimming-to-avoid-double-slashes-and-does-not-use-in-app-routing-for-this-action",
      "title": "On the `/login` page, ensure clicking the button labeled exactly \"Continue with Google\" performs a full-page redirect using `window.location.href = NEXT_PUBLIC_BACKEND_URL + \"/auth/google/start\"` (with safe trimming to avoid double slashes), and does not use in-app routing for this action.",
      "reqIds": [
        "REQ-183"
      ],
      "version": 1
    },
    {
      "id": "feature-when-next-public-backend-url-is-configured-non-empty-the-login-page-must-not-show-the-user-facing-error-message-google-login-not-configured-and-must-attempt-the-redirect-to-the-backend-oauth-start-endpoint-when-it-is-missing-empty-prevent-redirect-and-show-the-exact-message-google-login-not-configured",
      "title": "When `NEXT_PUBLIC_BACKEND_URL` is configured (non-empty), the login page must not show the user-facing error message \"Google login not configured\" and must attempt the redirect to the backend OAuth start endpoint; when it is missing/empty, prevent redirect and show the exact message \"Google login not configured\".",
      "reqIds": [
        "REQ-184"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-configuration-documentation-to-include-complete-copy-pastable-instructions-for-setting-next-public-backend-url-for-local-development-and-production-builds-the-same-backend-that-serves-auth-google-start",
      "title": "Update frontend configuration documentation to include complete, copy-pastable instructions for setting `NEXT_PUBLIC_BACKEND_URL` for local development and production builds (the same backend that serves `/auth/google/start`).",
      "reqIds": [
        "REQ-185"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-single-frontend-configuration-module-create-frontend-src-lib-config-ts-that-exports-getbackendbaseurl-with-the-following-resolution-order-1-if-process-env-next-public-backend-url-exists-and-is-a-non-empty-string-return-that-value-2-otherwise-if-the-app-can-reach-backend-endpoints-on-the-same-origin-under-the-api-prefix-return-window-location-origin-api-3-otherwise-return-a-constant-backend-url-fallback-https-dart-scoring-backend-caffeine-xyz-getbackendbaseurl-must-return-a-non-empty-string-in-all-browser-runtime-cases-so-the-google-flow-never-treats-the-backend-as-not-configured",
      "title": "Add a single frontend configuration module (create `frontend/src/lib/config.ts`) that exports `getBackendBaseUrl()` with the following resolution order:\n1) If `process.env.NEXT_PUBLIC_BACKEND_URL` exists and is a non-empty string, return that value.\n2) Otherwise, if the app can reach backend endpoints on the same origin under the `/api` prefix, return `window.location.origin + \"/api\"`.\n3) Otherwise, return a constant `BACKEND_URL_FALLBACK = \"https://dart-scoring-backend.caffeine.xyz\"`.\n\n`getBackendBaseUrl()` must return a non-empty string in all browser runtime cases (so the Google flow never treats the backend as “not configured”).",
      "reqIds": [
        "REQ-186"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-login-page-google-sign-in-button-continue-with-google-to-always-perform-a-full-page-redirect-using-window-location-href-getbackendbaseurl-auth-google-start-the-redirect-url-concatenation-must-be-safe-avoid-double-slashes-between-base-url-and-auth-google-start",
      "title": "Update the `/login` page Google sign-in button (\"Continue with Google\") to always perform a full-page redirect using:\n`window.location.href = getBackendBaseUrl() + \"/auth/google/start\"`\n\nThe redirect URL concatenation must be safe (avoid double slashes between base URL and `/auth/google/start`).",
      "reqIds": [
        "REQ-187"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-disable-the-user-facing-google-login-not-configured-error-flow-on-the-login-page-when-getbackendbaseurl-returns-any-value-the-goal-is-that-clicking-continue-with-google-must-never-show-a-not-configured-message-and-must-always-attempt-the-redirect",
      "title": "Remove/disable the user-facing \"Google login not configured\" error flow on the `/login` page when `getBackendBaseUrl()` returns any value. The goal is that clicking \"Continue with Google\" must never show a “not configured” message and must always attempt the redirect.",
      "reqIds": [
        "REQ-188"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-dev-debug-only-diagnostic-panel-titled-backend-debug-to-the-login-page-frontend-src-pages-loginpage-tsx-the-panel-must-be-rendered-only-in-development-debug-builds-e-g-import-meta-env-dev-true-and-must-not-appear-in-production-builds",
      "title": "Add a dev/debug-only diagnostic panel titled \"Backend Debug\" to the `/login` page (`frontend/src/pages/LoginPage.tsx`). The panel must be rendered only in development/debug builds (e.g., `import.meta.env.DEV === true`) and must not appear in production builds.",
      "reqIds": [
        "REQ-189"
      ],
      "version": 1
    },
    {
      "id": "feature-in-the-backend-debug-panel-on-login-display-the-detected-backend-url-used-by-the-google-sign-in-button-by-resolving-it-through-the-existing-frontend-config-getbackendbaseurl-from-frontend-src-lib-config-ts-show-it-with-the-exact-label-format-detected-backend-url",
      "title": "In the \"Backend Debug\" panel on `/login`, display the detected backend URL used by the Google sign-in button by resolving it through the existing frontend config (`getBackendBaseUrl()` from `frontend/src/lib/config.ts`). Show it with the exact label format: `Detected backend URL: <...>`.",
      "reqIds": [
        "REQ-190"
      ],
      "version": 1
    },
    {
      "id": "feature-in-the-backend-debug-panel-on-login-add-a-button-labeled-exactly-test-backend-that-performs-a-fetch-get-request-to-backendurl-health-use-safe-url-joining-and-displays-the-result-in-the-ui-no-alerts-it-must-show-ok-when-the-http-response-status-is-200-otherwise-show-failed-plus-a-short-error-description-suitable-for-display",
      "title": "In the \"Backend Debug\" panel on `/login`, add a button labeled exactly \"Test backend\" that performs a `fetch` GET request to `<backendUrl>/health` (use safe URL joining) and displays the result in the UI (no alerts). It must show \"OK\" when the HTTP response status is 200; otherwise show \"FAILED\" plus a short error description suitable for display.",
      "reqIds": [
        "REQ-191"
      ],
      "version": 1
    },
    {
      "id": "feature-in-the-backend-debug-panel-on-login-add-a-second-test-button-labeled-exactly-test-google-start-that-checks-the-url-backendurl-auth-google-start-and-displays-whether-the-endpoint-returns-a-success-redirect-200-or-302-versus-404-the-result-must-be-shown-in-the-ui-no-alerts-and-must-not-crash-the-page-under-any-error-condition",
      "title": "In the \"Backend Debug\" panel on `/login`, add a second test button labeled exactly \"Test Google start\" that checks the URL `<backendUrl>/auth/google/start` and displays whether the endpoint returns a success/redirect (200 or 302) versus 404. The result must be shown in the UI (no alerts) and must not crash the page under any error condition.",
      "reqIds": [
        "REQ-192"
      ],
      "version": 1
    },
    {
      "id": "feature-style-the-backend-debug-panel-as-a-small-simple-box-inside-the-login-page-below-the-existing-login-buttons-is-acceptable-using-existing-tailwind-shadcn-primitives-the-panel-must-keep-user-facing-text-in-english-and-must-not-affect-the-existing-login-flows",
      "title": "Style the \"Backend Debug\" panel as a small, simple box inside the `/login` page (below the existing login buttons is acceptable), using existing Tailwind/Shadcn primitives. The panel must keep user-facing text in English and must not affect the existing login flows.",
      "reqIds": [
        "REQ-193"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-developer-facing-verification-note-in-existing-deployment-documentation-describing-how-to-verify-the-backend-is-running-and-how-to-confirm-get-auth-google-start-responds-with-a-redirect-http-302-303",
      "title": "Add a developer-facing verification note in existing deployment documentation describing how to verify the backend is running and how to confirm `GET /auth/google/start` responds with a redirect (HTTP 302/303).",
      "reqIds": [
        "REQ-197"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-frontend-google-sign-in-flow-so-clicking-the-button-labeled-exactly-continue-with-google-performs-a-full-page-redirect-using-exactly-window-location-href-api-auth-google-start-no-environment-based-backend-base-url-resolution",
      "title": "Update the frontend Google sign-in flow so clicking the button labeled exactly \"Continue with Google\" performs a full-page redirect using exactly: `window.location.href = \"/api/auth/google/start\"` (no environment-based backend base URL resolution).",
      "reqIds": [
        "REQ-199"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-all-references-to-the-backend-domain-dart-scoring-backend-caffeine-xyz-from-the-codebase-and-documentation-and-ensure-the-app-no-longer-depends-on-any-separate-backend-domain-configuration-for-google-oauth-initiation",
      "title": "Remove all references to the backend domain `dart-scoring-backend.caffeine.xyz` from the codebase and documentation, and ensure the app no longer depends on any separate backend domain configuration for Google OAuth initiation.",
      "reqIds": [
        "REQ-200"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-dev-debug-only-backend-debug-panel-on-the-login-page-to-test-the-same-origin-api-endpoints-health-and-google-start-rather-than-using-any-external-backend-base-url-resolution",
      "title": "Update the dev/debug-only \"Backend Debug\" panel on the `/login` page to test the same-origin `/api` endpoints (health and Google start) rather than using any external backend base URL resolution.",
      "reqIds": [
        "REQ-201"
      ],
      "version": 1
    },
    {
      "id": "feature-update-deployment-reverse-proxy-guidance-config-so-api-remains-routed-to-the-backend-http-endpoints-under-the-same-application-origin-no-separate-backend-domain-while-preserving-spa-routing-for-non-asset-paths",
      "title": "Update deployment/reverse-proxy guidance/config so `/api/*` remains routed to the backend HTTP endpoints under the same application origin (no separate backend domain), while preserving SPA routing for non-asset paths.",
      "reqIds": [
        "REQ-202"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Set up Next.js + React + TypeScript PWA project foundation for \"Dart Scoring\"",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Implement routing/pages: / (Start Game) and /game (Game Screen)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Create basic responsive UI layout with header showing app name",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Create UI components and folder structure: PlayerCard, Keypad, TurnHistory (UI only, no game logic)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-5",
      "summary": "Implement `/` (Start Game) UI: 301/501 mode radio, Double Out switch, 1–4 players list with add/remove + name inputs, and Start Game navigation to `/game` passing settings (prefer localStorage) with auto-default player names if blank",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Implement core game data model + state management (Game/Player/Turn types; state: currentPlayerIndex, remaining per player, turn history) with functions startGame(settings), applyTurn(scoredPoints), undoLastTurn() and rules for bust + Double Out needsDoubleConfirmation flag",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Wire `/game` UI to game state: show player cards with remaining, highlight current player, implement keypad (input + digit buttons + Enter + quick chips 26/41/45/60/85/100/121/140/180), on Enter call applyTurn() and append history + advance player, add Undo to undoLastTurn(), and display last 5 turns",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Add end-of-leg/win handling: when remaining reaches 0 declare Game Over; if Double Out is ON and remaining reaches 0 prompt \"Was it a double finish?\" (YES ends game, NO treats as bust/undo turn). Provide Game Over screen showing winner + number of turns, with actions Rematch (same settings) and New Game (back to Start).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Add game persistence: save currentGame state to localStorage after every turn; on /game load if a saved game exists prompt \"Resume?\" with Resume / Discard actions",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Improve PWA for offline-first: add/verify manifest and implement a service worker with caching so the app works without internet after first load",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Add voice input mode on /game using Web Speech API (SpeechRecognition): show mic icon in score input; transcribe and parse spoken English numbers (e.g., “one forty”, “one hundred and forty”, “sixty”, “one eighty”) into a proposed score; display transcript + proposed number with OK/Edit confirmation; hide mic if browser unsupported",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Add a /game score-entry mode toggle: existing Total keypad vs new \"3 Darts\" per-dart entry (S/D/T + 1–20 grid + Outer Bull 25 + Bull 50), with 3 dart slots, Clear Dart/Clear All/Submit Turn; update game logic + Turn model to store darts list and compute bust/finish deterministically (Double Out requires last dart D or Bull) and show formatted history like “-140 (T20 T20 D20)” or “BUST (...)”",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Add optional Checkout Helper UI toggle: when a player's remaining <= 170, show 1–3 suggested checkout routes from a simple common-rules table; if Double Out is ON, suggestions must end on a double or bull",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Add per-game player statistics and a Stats screen: compute avg (per 3 darts), optional first 9 avg, count of 180s, checkout % (when Double Out ON), and bust count; add a \"Stats\" button available during the game and after Game Over showing a table of players + metrics",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Add Cameras settings (up to 3 slots) supporting Webcam (getUserMedia) and HLS URL with Test button; persist camera configuration in localStorage",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-16",
      "summary": "Add /game video panel to display 1–3 camera previews with layouts (1 large, 2 grid, 3 grid), per-preview controls (mute, pause), swap order, and fullscreen for selected preview",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Add Manual Review for last turn: 'Review' button near turn history opens modal with camera thumbnails + last turn details and actions Keep or Edit turn",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Implement 'Edit last turn' for both Total and 3-Darts entry; after saving, recompute game state by replaying turns from the edited point to ensure correct remaining/current player/history",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Add ShotEvent model (manual/voice/camera sources; proposed/confirmed/rejected; linking to turns) and persist it with the game state as foundation for future auto-scoring",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-20",
      "summary": "Design ScoringProvider interface (start/stop/onProposal) and include a stub provider that emits no proposals in MVP, but keeps UI/data model ready for future auto-scoring proposals",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-21",
      "summary": "Add backend foundation: separate FastAPI service scaffold with project structure (app/main.py, api routers, core config/auth stub/websocket manager, db SQLAlchemy models+session), GET /health -> {\"ok\": true}, CORS for frontend (localhost + production), .env config (DATABASE_URL, JWT_SECRET, etc.), and Dockerfile + docker-compose (backend + postgres); no game logic yet",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-22",
      "summary": "Implement a minimal backend canister foundation in `backend/main.mo` (Motoko, single-actor) that exposes a healthcheck method equivalent to `GET /health -> {\"ok\": true}`.",
      "reqIds": [
        "REQ-55"
      ],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Add an environment/configuration placeholder module/pattern appropriate for Internet Computer canisters (without using `.env` files) to represent settings like `DATABASE_URL` and `JWT_SECRET`, and ensure the app builds without requiring any real secrets.",
      "reqIds": [
        "REQ-56"
      ],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Add backend-side stubs/placeholders for authentication and websocket management (as internal Motoko modules or types), without implementing any game logic.",
      "reqIds": [
        "REQ-57"
      ],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Create a backend-side persistence stub that represents “DB connectivity” within Internet Computer constraints (no Postgres, no SQLAlchemy), using in-canister storage placeholders only, and ensure the canister remains functional without any external database.",
      "reqIds": [
        "REQ-58"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Design and implement backend Postgres data model for Dart Scoring using SQLAlchemy + Alembic migrations: tables users (optional/guest-ready), rooms, games, players, turns, shot_events with specified columns and enums; add indexes on rooms.code, games.room_id, and (turns.game_id, turns.turn_index)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "Implement a backend data model in Motoko that mirrors the user-requested Postgres/SQLAlchemy schema for dart scoring: users, rooms, games, players, turns, and shot_events, including the specified fields and enum-like values. This must be implemented using in-canister storage (stable data structures) consistent with the Internet Computer single-actor backend constraint.",
      "reqIds": [
        "REQ-59"
      ],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "Add in-canister index structures that correspond to the requested SQL indexes: rooms.code, games.room_id, and (turns.game_id, turns.turn_index). These indexes must be maintained consistently when creating/updating/deleting the corresponding entities.",
      "reqIds": [
        "REQ-60"
      ],
      "status": "pending"
    },
    {
      "id": "AR-29",
      "summary": "Replace the trap-only backend placeholder with a minimal, non-throwing healthcheck method on the Motoko actor so external tooling can confirm the backend canister is alive.",
      "reqIds": [
        "REQ-61"
      ],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Provide backend CRUD/query stub methods (no frontend wiring required) for creating and reading the core entities (rooms, games, players, turns, shot_events) sufficient to validate that the schema and indexes work end-to-end within canister storage.",
      "reqIds": [
        "REQ-62"
      ],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Update `backend/main.mo` to define a Motoko data model that mirrors the user-requested Postgres/SQLAlchemy schema for dart scoring, using in-canister storage only (no external database):\n- `users`: `id`, `email` (nullable), `name`, `created_at`\n- `rooms`: `id` (uuid), `code`, `name`, `created_at`\n- `games`: `id` (uuid), `room_id`, `mode` (301/501), `double_out` (bool), `status` (active/finished), `started_at`, `finished_at`, `winner_player_id` (nullable)\n- `players`: `id` (uuid), `game_id`, `name`, `seat_order` (int), `remaining` (int), `stats_json` (json)\n- `turns`: `id` (uuid), `game_id`, `player_id`, `turn_index` (int), `input_mode` (\"total\"|\"3darts\"), `scored_total` (int), `is_bust` (bool), `remaining_before` (int), `remaining_after` (int), `darts_json` (json), `created_at`\n- `shot_events`: `id` (uuid), `game_id`, `turn_id` (nullable), `timestamp`, `source` (\"manual\"|\"voice\"|\"camera\"), `status` (\"proposed\"|\"confirmed\"|\"rejected\"), `proposed_total` (nullable), `proposed_darts_json` (nullable), `confidence` (nullable), `camera_slot` (nullable)\n\nRepresent UUIDs as `Text` values (generated in-canister) and represent json/jsonb fields as `Text` (raw JSON string) to avoid adding a JSON library dependency. Keep types/variants for the enum-like fields (mode/status/input_mode/source/status).",
      "reqIds": [
        "REQ-63"
      ],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Implement and maintain in-canister index structures corresponding to the requested SQL indexes:\n- Index rooms by `room.code`\n- Index games by `game.room_id`\n- Composite index turns by `(turns.game_id, turns.turn_index)`\n\nIndexes must be updated consistently whenever the corresponding entities are created (and when updates are added later, the implementation must keep indexes correct).",
      "reqIds": [
        "REQ-64"
      ],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "Replace the current backend healthcheck implementation with a minimal, non-throwing method that returns a structured value equivalent to `GET /health -> {\"ok\": true}`.\n\nThis method must not trap and must be callable without any prerequisites.",
      "reqIds": [
        "REQ-65"
      ],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "Provide backend CRUD/query stub methods (no frontend wiring required) sufficient to validate that the schema and indexes work end-to-end within canister storage:\n- Create + get for: rooms, games, players, turns, shot_events (and users as optional but prepared)\n- Queries demonstrating each requested index:\n  - Get room by `code`\n  - List games by `room_id`\n  - List turns by `(game_id, turn_index)`\n\nMethods should return clear trap messages only for truly invalid references (e.g., creating a game for a missing room) and should otherwise succeed without trapping (e.g., list methods return empty arrays when appropriate).",
      "reqIds": [
        "REQ-66"
      ],
      "status": "pending"
    },
    {
      "id": "AR-35",
      "summary": "If the updated backend state introduces incompatible changes to existing stored state (e.g., changing stored map types or IDs), add/adjust `backend/migration.mo` per the project migration policy so upgrades do not brick the canister. The migration may reset state if no safe migration is feasible, but it must be explicit and deterministic.",
      "reqIds": [
        "REQ-67"
      ],
      "status": "pending"
    },
    {
      "id": "AR-36",
      "summary": "Add FastAPI REST API (MVP) for rooms + games: POST /rooms (optional name, generate 6-char code), GET /rooms/{code} (room data + active game if exists), POST /rooms/{code}/games (mode 301/501, double_out, players[]; create game+players with remaining=mode), GET /games/{game_id} (snapshot: game, players, last N turns, last N shot_events), POST /games/{game_id}/finish (finish game with winner_player_id); include Pydantic validation and sensible error codes",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Implement backend API methods on the Motoko actor that mirror the requested REST endpoints for Rooms: (1) create a room with an optional name and a generated 6-character code (POST /rooms), and (2) fetch a room by code returning the room data plus the currently active game for that room if one exists (GET /rooms/{code}).",
      "reqIds": [
        "REQ-68"
      ],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Implement backend API methods on the Motoko actor that mirror the requested REST endpoints for Games: (1) create a new game in a room by room code with validated input (mode 301/501, double_out boolean, players array of names) and create players with remaining initialized to the mode (POST /rooms/{code}/games), and (2) fetch a full game snapshot by game_id that includes game, players, and the last N turns and last N shot_events (GET /games/{game_id}).",
      "reqIds": [
        "REQ-69"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Implement a backend API method on the Motoko actor that mirrors finishing a game (POST /games/{game_id}/finish) by setting the game as finished/completed and recording winner_player_id, with validation that the winner belongs to the game.",
      "reqIds": [
        "REQ-70"
      ],
      "status": "pending"
    },
    {
      "id": "AR-40",
      "summary": "Add explicit request/response DTO types and validation-style error handling for the new backend API methods, using a consistent Result-like response shape with machine-readable error codes and English error messages (replacing trap-based control flow for expected client errors).",
      "reqIds": [
        "REQ-71"
      ],
      "status": "pending"
    },
    {
      "id": "AR-41",
      "summary": "Update/extend the backend in-canister data model and indexes in backend/main.mo as needed to support rooms (including optional name), games (mode, double_out, status, winner_player_id), players (name, remaining, seat/order), turns, and shot events required by the snapshot endpoint, while preserving and maintaining indexes for: room by code, games by room, and turns by (game_id, turn_index).",
      "reqIds": [
        "REQ-72"
      ],
      "status": "pending"
    },
    {
      "id": "AR-42",
      "summary": "If backend state layout changes are incompatible with existing deployed canister state, add or adjust backend/migration.mo according to the project migration policy so upgrades do not brick the canister (explicitly resetting state is acceptable for MVP if documented and deterministic).",
      "reqIds": [
        "REQ-73"
      ],
      "status": "pending"
    },
    {
      "id": "AR-43",
      "summary": "Implement backend game logic as source of truth: POST /games/{game_id}/turns (applyTurn for total or 3-darts input; compute scored_total, validate bust + double-out; persist turn; update player remaining; next player may be derived in snapshot), POST /games/{game_id}/undo (remove last turn and recompute remaining), PUT /turns/{turn_id} (edit turn and replay/recompute all subsequent turns); return updated game snapshot after each operation",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-44",
      "summary": "Implement a backend API method equivalent to `POST /games/{game_id}/turns` that applies a new turn to a game (backend is the source of truth) and returns an updated game snapshot after the operation.",
      "reqIds": [
        "REQ-74"
      ],
      "status": "pending"
    },
    {
      "id": "AR-45",
      "summary": "Implement backend scoring and rule enforcement for both input modes (\"total\" and \"3darts\"), including bust handling and deterministic double-out, with consistent stored fields on each created/updated turn.",
      "reqIds": [
        "REQ-75"
      ],
      "status": "pending"
    },
    {
      "id": "AR-46",
      "summary": "Implement a backend API method equivalent to `POST /games/{game_id}/undo` that removes the most recent turn for the given game and returns an updated game snapshot.",
      "reqIds": [
        "REQ-76"
      ],
      "status": "pending"
    },
    {
      "id": "AR-47",
      "summary": "Implement a backend API method equivalent to `PUT /turns/{turn_id}` that edits an existing turn (total or 3darts input) and deterministically replays/recomputes all subsequent turns from that point, returning an updated game snapshot.",
      "reqIds": [
        "REQ-77"
      ],
      "status": "pending"
    },
    {
      "id": "AR-48",
      "summary": "Standardize backend responses for the new gameplay mutation methods (create turn, undo, edit) so they always return either (a) an updated snapshot or (b) a structured, non-trapping error with a machine-readable code and an English message.",
      "reqIds": [
        "REQ-78"
      ],
      "status": "pending"
    },
    {
      "id": "AR-49",
      "summary": "Add realtime WebSocket support for rooms/games: WS /ws/rooms/{code} and WS /ws/games/{game_id}; frontend connects to /ws/games/{game_id}; after each mutation (new turn/undo/edit/finish) backend broadcasts {type:\"GAME_SNAPSHOT\", payload:<snapshot>} plus lightweight events TURN_ADDED/TURN_UNDONE/TURN_EDITED; include a simple ConnectionManager storing connections per game_id",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-50",
      "summary": "Add a backend-side realtime connection registry (“ConnectionManager”) that tracks active client connections per `game_id` and supports broadcasting events to all connections for a given `game_id`. The manager must support adding/removing connections and broadcasting JSON-serializable events.",
      "reqIds": [
        "REQ-79"
      ],
      "status": "pending"
    },
    {
      "id": "AR-52",
      "summary": "After every backend game mutation (new turn, undo, edit, finish), broadcast a canonical snapshot event to all connections in that game: `{ type: \"GAME_SNAPSHOT\", payload: <snapshot> }`, where `<snapshot>` is the same snapshot shape returned by the backend mutation endpoints.",
      "reqIds": [
        "REQ-81"
      ],
      "status": "pending"
    },
    {
      "id": "AR-53",
      "summary": "In addition to `GAME_SNAPSHOT`, broadcast lightweight events for the same mutations: `TURN_ADDED`, `TURN_UNDONE`, `TURN_EDITED`. These lightweight events may contain minimal payload, but `GAME_SNAPSHOT` must remain the source of truth for clients.",
      "reqIds": [
        "REQ-82"
      ],
      "status": "pending"
    },
    {
      "id": "AR-54",
      "summary": "Frontend multi-device flow: Start screen supports Create Room (POST /rooms -> show code) and Join Room (enter code -> GET /rooms/{code})",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-55",
      "summary": "Add separate frontend experiences for multi-device play: (1) Host/Scorer screen to create game + enter scores and call POST /turns, POST /undo, PUT /turns; (2) Display/TV screen read-only scoreboard + recent turns that connects via WebSocket and renders authoritative GAME_SNAPSHOT updates for parallel devices",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-58",
      "summary": "Implement backend room APIs needed for the multi-device Start screen:\n- Create room method (equivalent to POST /rooms) that generates a room code server-side and returns the created room.\n- Get room by code method (equivalent to GET /rooms/{code}) that returns the room data (and any active game reference if applicable).\nBackend methods must return structured, non-trapping errors for expected client failures (e.g., room not found).",
      "reqIds": [
        "REQ-86"
      ],
      "status": "pending"
    },
    {
      "id": "AR-59",
      "summary": "Add simple MVP authorization for multi-device play (no login): generate a scorer/admin token on room/game creation (e.g., room.admin_token) and require header X-ADMIN-TOKEN on all state-mutating endpoints (create turn/undo/edit/finish); read-only TV/display endpoints require only room code",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-60",
      "summary": "Extend the backend Room/Game data model to include an admin/scorer token (e.g., `adminToken : Text`) generated by the backend when creating a room (and, if needed, when creating a game). The token must be treated as a secret and must not be derivable from the room code.",
      "reqIds": [
        "REQ-91"
      ],
      "status": "pending"
    },
    {
      "id": "AR-61",
      "summary": "Update backend state-mutating methods so they require an admin token to be provided and validated. Any method that modifies backend state must enforce the equivalent of requiring HTTP header `X-ADMIN-TOKEN` by accepting a token parameter (since canister calls do not provide HTTP headers) and rejecting the call with a structured, non-trapping error when the token is missing/invalid.",
      "reqIds": [
        "REQ-92"
      ],
      "status": "pending"
    },
    {
      "id": "AR-62",
      "summary": "Ensure TV/display read-only flows do not require any token and continue to work using only the room code/game identifier (including realtime subscription).",
      "reqIds": [
        "REQ-93"
      ],
      "status": "pending"
    },
    {
      "id": "AR-63",
      "summary": "Prepare a simple, stable deployment package for the backend: docker-compose (backend + Postgres), documented environment variables, optional reverse proxy config (Caddy/Nginx) with backend working correctly behind proxy, /health endpoint verification, and step-by-step run instructions for dev and prod",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-64",
      "summary": "Add a stable, proxy-friendly health check on the backend canister that is callable without prerequisites and returns a structured value equivalent to `GET /health -> {\"ok\": true}` (not a human-readable string). Keep the existing `health()` method working for backward compatibility if it is already referenced anywhere, but introduce a new canonical health method that is machine-readable.",
      "reqIds": [
        "REQ-97"
      ],
      "status": "pending"
    },
    {
      "id": "AR-65",
      "summary": "Define and document the backend Game Snapshot schema/contract returned by game endpoints/mutations, including game fields (id, mode, double_out, status, current_player_id, ...), players (id, name, remaining, seat_order, stats), last_turns, and shot_events_last so the frontend can render without extra requests",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-66",
      "summary": "Define a canonical backend “Game Snapshot” response schema and return it from backend game read/mutation paths so the frontend can render a complete game view without additional requests. The snapshot must contain these top-level keys: `game`, `players`, `last_turns`, `shot_events_last`.\n\nMinimum required fields:\n- `game`: `{ id, mode, double_out, status, current_player_id, room_id?, started_at?, finished_at?, winner_player_id? }`\n- `players`: array of `{ id, name, remaining, seat_order, stats }` (stats may be a JSON/text blob but must be present)\n- `last_turns`: array of turn objects sufficient to render recent turns (include ids, player reference, ordering/index, totals, bust/win flags, remaining before/after, and any darts breakdown if available)\n- `shot_events_last`: array of shot-event objects sufficient to render recent shot events (include ids, timestamp, source, status, and proposed totals/darts if present)\n\nThe backend must ensure the snapshot is self-contained: it must include everything needed for the UI to show current player, scoreboard (remaining), recent turns, and recent shot events without requiring follow-up calls.",
      "reqIds": [
        "REQ-101"
      ],
      "status": "pending"
    },
    {
      "id": "AR-67",
      "summary": "Add full user accounts + authentication: extend/create users table (id uuid, email unique, username unique, password_hash, created_at, last_login_at); implement password hashing (bcrypt/argon2); implement JWT auth with access token (15–60 min) + refresh token (~30 days) stored in refresh_tokens table (id, user_id, token_hash, expires_at, revoked_at); add endpoints POST /auth/register, POST /auth/login (email_or_username,password -> access_token, refresh_token, user), POST /auth/refresh, POST /auth/logout (revoke refresh), GET /me (requires JWT); add middleware/dependency get_current_user() to protect endpoints",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-68",
      "summary": "Implement a backend user account registry in `backend/main.mo` using Internet Identity (caller `Principal`) as the authentication mechanism. Add a `User` record with fields analogous to the requested schema (id, email, username, createdAt, lastLoginAt) and store users in-canister, keyed by caller principal (and maintain uniqueness indexes for `email` and `username`).",
      "reqIds": [
        "REQ-105"
      ],
      "status": "pending"
    },
    {
      "id": "AR-69",
      "summary": "Add backend methods that provide a practical equivalent of the requested auth endpoints but adapted to Internet Identity: (1) create/update the caller’s profile (register), (2) fetch the current user (GET /me equivalent), and (3) clear/remove the user profile (optional logout-equivalent for app data). These methods must rely on `caller` identity and must not require passwords or JWTs.",
      "reqIds": [
        "REQ-106"
      ],
      "status": "pending"
    },
    {
      "id": "AR-70",
      "summary": "Add player↔user profile linking: extend `players` with nullable `user_id` (FK to users) and `display_name` (in-game name; default to user.username when logged in). Support game creation flow where logged-in seats can be assigned to a `user_id` or set as Guest (`user_id=null`). Add endpoint `POST /games/{game_id}/players/{player_id}/claim` allowing a logged-in user to claim/attach to a player with constraints (e.g., only before game start and/or only room admin can claim).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-71",
      "summary": "Extend the backend Player data model to distinguish between an in-game player (seat) and an authenticated account by adding: (1) `user_id` as a nullable reference to a User profile, and (2) `display_name` as the text used in-game (defaulting to the linked user’s username when linked). Preserve existing player identity fields and ensure guest seats are represented with `user_id = null`.",
      "reqIds": [
        "REQ-108"
      ],
      "status": "pending"
    },
    {
      "id": "AR-72",
      "summary": "Update backend game creation / player creation flows to support seat assignment to either a logged-in user profile (`user_id`) or Guest (`user_id = null`). When the caller is authenticated and a seat is assigned to the caller’s user, default `display_name` to the caller’s `username`.",
      "reqIds": [
        "REQ-109"
      ],
      "status": "pending"
    },
    {
      "id": "AR-73",
      "summary": "Implement a backend method equivalent to the requested endpoint `POST /games/{game_id}/players/{player_id}/claim` that allows an authenticated Internet Identity caller to claim/attach their user profile to an existing player seat by setting `player.user_id` and updating `player.display_name` (defaulting to the user’s `username` if needed). Include server-side authorization constraints: the claim must be allowed only when the game has not started yet (e.g., game status is Pending) OR when a valid room admin/scorer token is provided.",
      "reqIds": [
        "REQ-110"
      ],
      "status": "pending"
    },
    {
      "id": "AR-77",
      "summary": "If the backend state layout changes introduced by player linking are incompatible with existing deployed canister state, add/adjust `backend/migration.mo` according to the project migration policy so upgrades do not brick the canister. If no safe migration is feasible, perform an explicit deterministic reset and document it in code comments.",
      "reqIds": [
        "REQ-114"
      ],
      "status": "pending"
    },
    {
      "id": "AR-78",
      "summary": "Add per-user Game Library / history APIs: implement GET /users/{user_id}/games with pagination + filters (mode, from/to) returning participation list with fields (game_id, started_at, finished_at, mode, double_out, place/rank, avg, 180s, checkout%, win); extend GET /games/{game_id} snapshot to include final result for winner (remaining=0) and provide full turns list via paginated GET /games/{game_id}/turns; ensure DB/schema includes games.finished_at and games.winner_player_id and that finishing a game persists winner + finished_at and final scores",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-79",
      "summary": "Extend the backend in-canister Game data model to persist completed-game metadata by adding: (1) `finished_at` timestamp and (2) `winner_player_id` (nullable) to each game record, and ensure these fields are returned wherever a game is returned in backend APIs.",
      "reqIds": [
        "REQ-115"
      ],
      "status": "pending"
    },
    {
      "id": "AR-80",
      "summary": "Ensure that when a game is finished/completed by backend gameplay logic, the backend persists the final result by setting `games.finished_at` and `games.winner_player_id` and keeping player remaining scores consistent with the final outcome (winner remaining must be 0).",
      "reqIds": [
        "REQ-116"
      ],
      "status": "pending"
    },
    {
      "id": "AR-81",
      "summary": "Add a backend query API equivalent to `GET /users/{user_id}/games?limit=&offset=&mode=&from=&to=` that returns a paginated list of games in which the user participated (participation defined as `player.user_id == user_id`). Support optional filters: mode, from timestamp, to timestamp, plus limit/offset pagination.",
      "reqIds": [
        "REQ-117"
      ],
      "status": "pending"
    },
    {
      "id": "AR-82",
      "summary": "For the `GET /users/{user_id}/games` participation list response, return per-game/per-user fields: `game_id`, `started_at`, `finished_at`, `mode`, `double_out`, `place` (or `rank`), `avg`, `180s`, `checkout%`, and `win` (boolean) computed for that user’s player seat in that game.",
      "reqIds": [
        "REQ-118"
      ],
      "status": "pending"
    },
    {
      "id": "AR-83",
      "summary": "Extend the backend game read API equivalent to `GET /games/{game_id}` (snapshot) so that for completed games it includes explicit final result information: winner (by `winner_player_id`) and confirmation that the winner’s remaining is 0, in addition to existing snapshot fields.",
      "reqIds": [
        "REQ-119"
      ],
      "status": "pending"
    },
    {
      "id": "AR-84",
      "summary": "Provide access to the full list of turns for a game via a paginated backend query equivalent to `GET /games/{game_id}/turns?limit&offset`. This must return turns in chronological order (turn_index ascending) and support limit/offset pagination.",
      "reqIds": [
        "REQ-120"
      ],
      "status": "pending"
    },
    {
      "id": "AR-85",
      "summary": "Update backend error handling for the new history/turn-list APIs so that expected client errors (e.g., game not found, invalid pagination parameters) return structured, non-trapping errors with machine-readable codes and English messages, rather than trapping.",
      "reqIds": [
        "REQ-121"
      ],
      "status": "pending"
    },
    {
      "id": "AR-86",
      "summary": "Add cached per-user aggregated stats: create user_stats storage/table (games_played, wins, win_rate, avg_3dart_overall, optional first9_avg_overall, checkout_attempts/success/rate, total_180s, total_busts, updated_at); recompute stats for users involved after game finish (preferred) and expose GET /me/stats and GET /users/{id}/stats endpoints returning user_stats",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-87",
      "summary": "Add a new backend in-canister storage table/map for cached per-user aggregated statistics named `user_stats`, keyed by `user_id` (the authenticated Internet Identity Principal as Text), with the following fields: `games_played`, `wins`, `win_rate`, `avg_3dart_overall`, optional `first9_avg_overall`, `checkout_attempts`, `checkout_success`, `checkout_rate`, `total_180s`, `total_busts`, and `updated_at`.",
      "reqIds": [
        "REQ-122"
      ],
      "status": "pending"
    },
    {
      "id": "AR-88",
      "summary": "Implement backend stats recomputation for all users participating in a game when the game is completed (preferred), using the game’s turns as the source of truth, and persist the updated `user_stats` records for each affected `user_id`.",
      "reqIds": [
        "REQ-123"
      ],
      "status": "pending"
    },
    {
      "id": "AR-89",
      "summary": "Define and implement the exact aggregated-stat calculation rules for `user_stats` based on completed games:\n- `games_played`: count of completed games where the user participated (`player.userId == user_id`).\n- `wins`: count of those games where that user’s player seat is the winner.\n- `win_rate = wins / games_played` (0 when `games_played == 0`).\n- `avg_3dart_overall`: across all the user’s turns in completed games, compute `avg = (sum_scored_points / darts_thrown) * 3`.\n  - MVP darts-thrown rule: count darts as 3 per turn; in 3-darts mode also exactly 3.\n- `total_180s`: count turns with `turnTotal == 180`.\n- `total_busts`: count turns where `turn.is_bust == true`.\n- `checkout_attempts`, `checkout_success`, `checkout_rate`: MVP simplification allowed:\n  - Attempt: a turn where `remaining_before <= 170`.\n  - Success: an attempt turn that finishes the game for that player (turn results in a valid finish, i.e., game completed and this player is the winner, and the finishing turn is attributable to that player).\n  - `checkout_rate = checkout_success / checkout_attempts` (0 when attempts == 0).\n- `first9_avg_overall` is optional; if implemented, define it clearly and ensure it is consistent across all users.",
      "reqIds": [
        "REQ-124"
      ],
      "status": "pending"
    },
    {
      "id": "AR-90",
      "summary": "Extend/adjust backend stored turn data so that stats recomputation can be performed without guessing. At minimum, ensure turns persisted for completed games contain fields required by the rules: `turnTotal` (or equivalent numeric total), `is_bust`, and `remaining_before` (for checkout attempts). If the backend already has richer turn schema elsewhere, align the stats computation to that canonical schema; otherwise, evolve the `Turn` type and storage accordingly while keeping the canister upgrade-safe per the migration policy.",
      "reqIds": [
        "REQ-125"
      ],
      "status": "pending"
    },
    {
      "id": "AR-91",
      "summary": "Expose backend query endpoints equivalent to:\n- `GET /me/stats` → return the caller’s `user_stats` record.\n- `GET /users/{id}/stats` → return the `user_stats` record for the specified `user_id`.\nImplement these as Motoko actor methods that return the cached stats (or a clear, structured not-found result) without trapping for expected cases.",
      "reqIds": [
        "REQ-126"
      ],
      "status": "pending"
    },
    {
      "id": "AR-92",
      "summary": "Add per-game per-player stats persistence: create a `player_game_stats` table/map (id, game_id, player_id, user_id nullable, darts_thrown, points_scored_total, avg_3dart, optional first9_avg, num_180s, num_busts, checkout_attempts, checkout_success, created_at) and populate/update it when a game is finished (on finish game).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-93",
      "summary": "Add a new backend storage table/map named `player_game_stats` that persists per-player statistics for a specific finished game, with the following fields: `id`, `game_id`, `player_id`, `user_id` (nullable), `darts_thrown`, `points_scored_total`, `avg_3dart`, `first9_avg` (optional/nullable), `num_180s`, `num_busts`, `checkout_attempts`, `checkout_success`, `created_at`. The data must be stored in-canister in `backend/main.mo` and survive across queries.",
      "reqIds": [
        "REQ-127"
      ],
      "status": "pending"
    },
    {
      "id": "AR-94",
      "summary": "Populate `player_game_stats` when a game is finished. When the backend marks a game as completed (e.g., in the existing finish path `setGameWinner`), compute and persist one `player_game_stats` record per player in that game using the game’s stored turns as the source of truth.",
      "reqIds": [
        "REQ-128"
      ],
      "status": "pending"
    },
    {
      "id": "AR-95",
      "summary": "Expose backend query method(s) to retrieve `player_game_stats` so it can be used later for history/rankings. Add at minimum: (1) list stats by `game_id`, and (2) list stats by `user_id` (for completed games only). These methods must return empty arrays when no records exist and must not trap for expected 'not found' cases.",
      "reqIds": [
        "REQ-129"
      ],
      "status": "pending"
    },
    {
      "id": "AR-96",
      "summary": "Ensure the canister upgrade path remains safe after adding `player_game_stats`. If adding the new storage changes the stable state layout, implement/adjust `backend/migration.mo` according to the project migration policy so upgrades do not brick the canister; initialize `player_game_stats` to an empty collection when upgrading from older state.",
      "reqIds": [
        "REQ-130"
      ],
      "status": "pending"
    },
    {
      "id": "AR-97",
      "summary": "Rooms permissions & security: extend Room with owner_user_id (nullable, set when logged-in user creates room) and admin_token_hash (for no-account mode). Enforce that all state-mutating game operations require either the room owner’s JWT or an X-ADMIN-TOKEN; keep scoreboard viewing public via room code or game_id.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-98",
      "summary": "Extend the backend Room data model to include `owner_user_id` (nullable) and `admin_token_hash` (for no-account mode), and stop storing or returning the raw admin token except at creation time.",
      "reqIds": [
        "REQ-131"
      ],
      "status": "pending"
    },
    {
      "id": "AR-99",
      "summary": "Implement authorization rules for all backend state-mutating room/game operations so that they require either (a) the room owner (authenticated Internet Identity caller matching `owner_user_id`) OR (b) a valid admin token provided by the caller (validated by hashing and comparing with `admin_token_hash`).",
      "reqIds": [
        "REQ-132"
      ],
      "status": "pending"
    },
    {
      "id": "AR-100",
      "summary": "Update backend room creation to support both modes: (1) account mode where a logged-in creator becomes `owner_user_id` and may also receive a generated admin token (optional), and (2) no-account mode where `owner_user_id` is null and an admin token is generated and returned once, but only its hash is stored.",
      "reqIds": [
        "REQ-133"
      ],
      "status": "pending"
    },
    {
      "id": "AR-101",
      "summary": "Make scoreboard viewing public: backend read-only queries needed for TV/display access must be callable without authentication using either room code or game_id, while keeping write operations protected per REQ-132.",
      "reqIds": [
        "REQ-134"
      ],
      "status": "pending"
    },
    {
      "id": "AR-103",
      "summary": "Add/adjust backend upgrade migration so existing deployed canister state remains upgrade-safe after changing the Room schema (and any related authorization/token storage changes).",
      "reqIds": [
        "REQ-136"
      ],
      "status": "pending"
    },
    {
      "id": "AR-104",
      "summary": "Frontend (Next.js): add auth + account/history pages: /login, /register, /profile (me: username + stats), /history (user games list with filters), /games/[id] (game details incl. turns; charts/heatmaps later). Implement token handling with refresh token in httpOnly cookie (production approach) and access token kept in memory with background refresh.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-105",
      "summary": "Extend existing `users` DB model to support Google OAuth linking by adding nullable fields `oauth_provider` (e.g., 'google') and `oauth_subject` (Google sub), plus `email_verified` (bool, default false). Add a unique index on `(oauth_provider, oauth_subject)`. Do not change existing email+password login. Provide a DB migration for these schema changes.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-106",
      "summary": "Extend the backend `User` data model in `backend/main.mo` to include the following new fields for OAuth account linking, without changing the existing email + username registration flow:\n- `oauth_provider : ?Text` (nullable; example value: \"google\")\n- `oauth_subject : ?Text` (nullable; stores the OAuth subject, e.g. Google `sub`)\n- `email_verified : Bool` (default `false` for newly created users)\n\nEnsure existing code paths that create `User` records (e.g. `register(email, username)`) initialize these fields (`oauth_provider = null`, `oauth_subject = null`, `email_verified = false`) and continue to behave as they do today for email/username uniqueness and validation.",
      "reqIds": [
        "REQ-145"
      ],
      "status": "pending"
    },
    {
      "id": "AR-107",
      "summary": "Add and maintain a uniqueness index for OAuth-linked identities in the backend such that the pair `(oauth_provider, oauth_subject)` is unique across all users.\n\nImplement this as an in-canister index structure (e.g., a `Map<Text, Text>` keyed by a deterministic composite key derived from provider + subject) and ensure it is enforced whenever a user record is created or updated in a way that sets/changes both `oauth_provider` and `oauth_subject` to non-null values.",
      "reqIds": [
        "REQ-146"
      ],
      "status": "pending"
    },
    {
      "id": "AR-108",
      "summary": "Add an explicit backend migration step for the new `User` fields and OAuth uniqueness index so upgrades do not break the canister when moving from an older deployed version.\n\nFollow the project migration policy (conditional migration). If a dedicated migration file does not exist in the repo, create `backend/migration.mo` and wire it according to the project’s existing upgrade approach so that:\n- existing users gain the new fields with safe defaults (`oauth_provider = null`, `oauth_subject = null`, `email_verified = false`)\n- the new OAuth uniqueness index is initialized and (if possible) backfilled from existing user data\n\nIf no safe migration is feasible for existing deployed state, perform an explicit deterministic reset and document it in code comments (English).",
      "reqIds": [
        "REQ-147"
      ],
      "status": "pending"
    },
    {
      "id": "AR-109",
      "summary": "Add backend configuration for Google OAuth via environment variables: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_REDIRECT_URI, FRONTEND_OAUTH_REDIRECT; provide sensible dev defaults and document in README; do not change existing auth settings.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-110",
      "summary": "Add backend configuration plumbing for Google OAuth using the following configuration keys (names must match exactly): GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_REDIRECT_URI, FRONTEND_OAUTH_REDIRECT. The backend must have a single authoritative configuration object/record for these values, and it must be safe to run in local development without any secrets by using sensible non-empty defaults.",
      "reqIds": [
        "REQ-148"
      ],
      "status": "pending"
    },
    {
      "id": "AR-111",
      "summary": "Expose a backend query method to retrieve the current Google OAuth configuration in a safe shape suitable for frontend usage, ensuring that secrets are not leaked (GOOGLE_CLIENT_SECRET must not be returned).",
      "reqIds": [
        "REQ-149"
      ],
      "status": "pending"
    },
    {
      "id": "AR-112",
      "summary": "Update upgrade safety to account for any new stable configuration state introduced for Google OAuth, following the project’s conditional migration policy so canister upgrades do not brick existing deployments.",
      "reqIds": [
        "REQ-150"
      ],
      "status": "pending"
    },
    {
      "id": "AR-113",
      "summary": "Add endpoint GET /auth/google/start that generates a one-time random state (TTL 10 min), persists it (DB or cache), and responds with a 302 redirect to Google Authorization Endpoint with scope `openid email profile` and params `client_id`, `redirect_uri`, `response_type=code`, `state`.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-114",
      "summary": "Implement an HTTP GET endpoint at path `/auth/google/start` in the backend canister that returns an HTTP 302 redirect to the Google OAuth Authorization Endpoint.",
      "reqIds": [
        "REQ-152"
      ],
      "status": "pending"
    },
    {
      "id": "AR-115",
      "summary": "On each call to `GET /auth/google/start`, generate a cryptographically strong random `state` value that is single-use and has a TTL of 10 minutes.",
      "reqIds": [
        "REQ-153"
      ],
      "status": "pending"
    },
    {
      "id": "AR-116",
      "summary": "Persist generated OAuth `state` values server-side in canister storage (acting as a DB/cache) along with their expiration time, and ensure expired states are not considered valid after 10 minutes.",
      "reqIds": [
        "REQ-154"
      ],
      "status": "pending"
    },
    {
      "id": "AR-117",
      "summary": "Ensure canister upgrades remain safe after introducing OAuth state persistence; if the stable state layout changes, add `backend/migration.mo` per the project migration policy (conditional), initializing any new state structures deterministically.",
      "reqIds": [
        "REQ-155"
      ],
      "status": "pending"
    },
    {
      "id": "AR-118",
      "summary": "Implement Google OAuth callback flow: add GET /auth/google/callback?code=&state= that validates stored single-use state (must exist, not used, not expired), exchanges code at Google Token Endpoint, fetches user profile (sub, email, email_verified, name via id_token/userinfo), maps/links user (match existing by oauth_provider='google' + oauth_subject=sub; else if user exists by email AND email_verified=true then link Google to that user; else create new user with email + username derived from name/email and set oauth fields), then issue existing JWT access token and redirect to FRONTEND_OAUTH_REDIRECT?token=<JWT>",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-119",
      "summary": "Add a backend HTTP GET endpoint at path `/auth/google/callback?code=&state=` that completes the Google OAuth callback flow by validating the `state`, exchanging the `code` for Google tokens via the Google Token Endpoint, fetching the Google user profile (`sub`, `email`, `email_verified`, `name` via `id_token` and/or Google UserInfo), mapping/linking or creating a user record per the specified rules, issuing the app’s existing JWT access token, and returning an HTTP redirect to `FRONTEND_OAUTH_REDIRECT?token=<JWT>`.",
      "reqIds": [
        "REQ-156"
      ],
      "status": "pending"
    },
    {
      "id": "AR-120",
      "summary": "Extend backend OAuth state persistence so each stored OAuth `state` value can be validated as: exists, not expired (TTL 10 minutes), and not previously used; include deterministic cleanup of expired/used states to prevent unbounded growth.",
      "reqIds": [
        "REQ-157"
      ],
      "status": "pending"
    },
    {
      "id": "AR-121",
      "summary": "Update the backend User linking behavior so that linking a Google identity to an existing user updates the user record (`oauth_provider`, `oauth_subject`, `email_verified`) and maintains the OAuth composite uniqueness index consistently.",
      "reqIds": [
        "REQ-158"
      ],
      "status": "pending"
    },
    {
      "id": "AR-122",
      "summary": "Ensure the backend has/uses a single authoritative configuration source for `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, `GOOGLE_REDIRECT_URI`, and `FRONTEND_OAUTH_REDIRECT` for the callback flow, and do not expose `GOOGLE_CLIENT_SECRET` in any query response.",
      "reqIds": [
        "REQ-159"
      ],
      "status": "pending"
    },
    {
      "id": "AR-123",
      "summary": "If implementing the callback flow requires incompatible stable-state changes (e.g., changing OAuth state storage schema or adding new stable fields), add a conditional `backend/migration.mo` and wire it per the project migration policy so canister upgrades do not brick existing deployments.",
      "reqIds": [
        "REQ-160"
      ],
      "status": "pending"
    },
    {
      "id": "AR-124",
      "summary": "Implement a backend HTTP GET endpoint at path `/auth/google/callback?code=&state=` that completes the Google OAuth callback flow and responds with an HTTP 302 redirect to the configured frontend redirect URL.",
      "reqIds": [
        "REQ-161"
      ],
      "status": "pending"
    },
    {
      "id": "AR-125",
      "summary": "Validate OAuth `state` in the callback: ensure the provided `state` exists in server-side storage, has not been used before, and has not expired based on TTL; then mark it as used as a single-use value.",
      "reqIds": [
        "REQ-162"
      ],
      "status": "pending"
    },
    {
      "id": "AR-126",
      "summary": "Exchange the OAuth authorization `code` for tokens by sending a POST request to the Google Token Endpoint with `client_id`, `client_secret`, `code`, `grant_type=authorization_code`, and `redirect_uri`, then parse the response to extract `access_token` and (if present) `id_token`.",
      "reqIds": [
        "REQ-163"
      ],
      "status": "pending"
    },
    {
      "id": "AR-127",
      "summary": "Fetch the authenticated user profile from the Google UserInfo endpoint using the `access_token` (do not rely on verifying `id_token` in this MVP): GET `https://openidconnect.googleapis.com/v1/userinfo` with `Authorization: Bearer <access_token>`, then extract at minimum `sub`, `email`, `email_verified`, and `name` (optionally `given_name`).",
      "reqIds": [
        "REQ-164"
      ],
      "status": "pending"
    },
    {
      "id": "AR-128",
      "summary": "Map/link/create a user based on Google userinfo and existing backend user storage using these rules: (1) if a user exists with `(oauth_provider='google', oauth_subject=sub)` use that user; else (2) if a user exists with `email == userinfo.email` AND `userinfo.email_verified == true`, link Google identity to that user by setting `oauth_provider`, `oauth_subject`, and `email_verified`; else (3) create a new user with `email=userinfo.email`, `oauth_provider='google'`, `oauth_subject=sub`, `email_verified=userinfo.email_verified`, and a derived unique `username` (from `name` or the local-part of email; append a numeric suffix on collisions).",
      "reqIds": [
        "REQ-165"
      ],
      "status": "pending"
    },
    {
      "id": "AR-129",
      "summary": "Issue an application access JWT for the mapped user using the same JWT format and signing behavior as the existing standard login flow (at minimum: `sub=user_id`, `exp=<expiry>`), then redirect to `FRONTEND_OAUTH_REDIRECT?token=<JWT>`.",
      "reqIds": [
        "REQ-166"
      ],
      "status": "pending"
    },
    {
      "id": "AR-130",
      "summary": "Implement error redirect behavior for the callback: for any expected error (missing code/state, invalid/expired/used state, token exchange failure, userinfo failure, missing email, mapping conflict), return an HTTP 302 redirect to `FRONTEND_OAUTH_REDIRECT?error=<short_code>` using short, stable machine-readable error codes and log only those codes.",
      "reqIds": [
        "REQ-167"
      ],
      "status": "pending"
    },
    {
      "id": "AR-131",
      "summary": "Frontend: add “Continue with Google” on /login that redirects to backend /auth/google/start; implement FRONTEND_OAUTH_REDIRECT handler page/route to read token (or error) from query, store token via the same session mechanism as normal login, then redirect to /profile (or dashboard) with English error handling for missing token / consent denied",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-132",
      "summary": "Google OAuth security hardening (minimum): make OAuth state single-use (mark used/delete after use) with TTL 10 minutes; if Google email_verified is false then do not link to an existing account by email (only create new or block); never log access/refresh/OAuth tokens in logs",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-133",
      "summary": "Implement a secure OAuth `state` lifecycle for the backend Google OAuth flow: each generated `state` must be single-use and must expire after 10 minutes (TTL). The backend must persist `state` values server-side, validate them in the callback (exists, not expired, not used), and then immediately mark them as used and/or remove them so they cannot be replayed.",
      "reqIds": [
        "REQ-171"
      ],
      "status": "pending"
    },
    {
      "id": "AR-134",
      "summary": "Enforce Google account linking rules during Google OAuth user mapping: if Google `email_verified` is `false`, the backend must NOT link the Google identity to an existing user by matching email. In that case, the backend must follow the project’s intended behavior (create a new user or block), but it must not attach Google OAuth fields to an existing account based on unverified email.",
      "reqIds": [
        "REQ-172"
      ],
      "status": "pending"
    },
    {
      "id": "AR-135",
      "summary": "Ensure tokens and other sensitive OAuth secrets are never written to logs in the backend Google OAuth flow. This includes (at minimum) OAuth authorization codes, `access_token`, `refresh_token`, `id_token`, and any application-issued tokens; log only short, stable error codes when needed.",
      "reqIds": [
        "REQ-173"
      ],
      "status": "pending"
    },
    {
      "id": "AR-136",
      "summary": "Maintain upgrade safety for any new/changed backend persisted state introduced by the OAuth hardening (e.g., OAuth state storage shape). If stable memory layout changes are required, add a conditional `backend/migration.mo` and wire it according to the project migration policy so canister upgrades do not brick existing deployments.",
      "reqIds": [
        "REQ-174"
      ],
      "status": "pending"
    },
    {
      "id": "AR-137",
      "summary": "Fix frontend OAuth login crash by ensuring the entire app is wrapped in <OAuthTokenSessionProvider> (root level), preventing useOAuthTokenSession usage outside the provider, and adding a safe fallback so missing provider returns an unauthenticated/null state instead of throwing; Sign In page must render normally without crashing (no backend changes).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-140",
      "summary": "Audit and update any OAuth/login-related components/hooks usage so `useOAuthTokenSession` is not used in module scope or in any way that could execute before React context is available (e.g., avoid calling it outside React components/hooks). Ensure the Sign In page path remains functional and shows the normal login UI under all expected loading/error states.",
      "reqIds": [
        "REQ-177"
      ],
      "status": "pending"
    },
    {
      "id": "AR-142",
      "summary": "Add a dev/debug-only \"Backend Debug\" diagnostic panel on the /login page that shows the detected backend URL (same as Google button), provides a \"Test backend\" button that GET fetches <backendUrl>/health and displays OK on 200 or FAILED + short error, and provides a \"Test Google start\" button that fetches or opens <backendUrl>/auth/google/start and shows whether response is 200/302 vs 404; render results in UI (no alerts), frontend-only change, must not crash.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-143",
      "summary": "Ensure the backend canister exposes a public HTTP endpoint equivalent to `GET /auth/google/start` that generates a redirect to start the Google OAuth flow.",
      "reqIds": [
        "REQ-194"
      ],
      "status": "pending"
    },
    {
      "id": "AR-144",
      "summary": "Implement server-side OAuth `state` generation and persistence for `GET /auth/google/start` so that each request produces a single-use state value with a 10-minute TTL (expiration), stored in canister memory for later validation by the callback flow.",
      "reqIds": [
        "REQ-195"
      ],
      "status": "pending"
    },
    {
      "id": "AR-145",
      "summary": "Keep `GET /auth/google/start` independent from any JWT-based authorization logic and ensure it remains publicly accessible even if other backend endpoints use authentication/authorization mixins.",
      "reqIds": [
        "REQ-196"
      ],
      "status": "pending"
    },
    {
      "id": "AR-146",
      "summary": "Serve all backend endpoints from the same app under `/api/*` (no separate backend app/domain): expose `/api/health`, `/api/auth/google/start`, `/api/auth/google/callback` (and rooms/auth routes) and update the frontend Google sign-in redirect to `window.location.href = \"/api/auth/google/start\"`; remove all references to `dart-scoring-backend.caffeine.xyz`; verify post-deploy behavior.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-147",
      "summary": "Expose all backend HTTP endpoints under the same application origin using the `/api/...` path prefix, including at minimum: `/api/health`, `/api/auth/google/start`, and `/api/auth/google/callback` (and any existing rooms/auth endpoints used by the multi-device flow).",
      "reqIds": [
        "REQ-198"
      ],
      "status": "pending"
    },
    {
      "id": "AR-148",
      "summary": "Fix /api/* returning Not Found by adding minimal Next.js API route handlers: implement /api/health (200 {ok:true}), /api/auth/google/start (302 redirect placeholder), /api/auth/google/callback (200 JSON \"callback reached\") using App Router (app/api/**/route.ts) or Pages Router fallback (pages/api/**.ts) depending on project structure; deploy and verify endpoints; do not change UI.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-149",
      "summary": "Implement same-origin API route handler for `GET /api/health` so it returns HTTP 200 with JSON body exactly `{ \"ok\": true }` (no Not Found). Prefer implementing via Next.js App Router route handler at `app/api/health/route.ts` if the project uses the `/app` directory. If the project uses the Pages Router instead, implement the equivalent handler at `pages/api/health.ts`.",
      "reqIds": [
        "REQ-203"
      ],
      "status": "pending"
    },
    {
      "id": "AR-150",
      "summary": "Implement same-origin API route handler for `GET /api/auth/google/start` so it is not Not Found and responds with an HTTP redirect (302 is acceptable) to a placeholder URL for now. Prefer implementing via Next.js App Router route handler at `app/api/auth/google/start/route.ts` if the project uses the `/app` directory. If the project uses the Pages Router instead, implement the equivalent handler at `pages/api/auth/google/start.ts`.",
      "reqIds": [
        "REQ-204"
      ],
      "status": "pending"
    },
    {
      "id": "AR-151",
      "summary": "Implement same-origin API route handler for `GET /api/auth/google/callback` so it returns HTTP 200 with JSON indicating the callback was reached. Prefer implementing via Next.js App Router route handler at `app/api/auth/google/callback/route.ts` if the project uses the `/app` directory. If the project uses the Pages Router instead, implement the equivalent handler at `pages/api/auth/google/callback.ts`.",
      "reqIds": [
        "REQ-205"
      ],
      "status": "pending"
    },
    {
      "id": "AR-152",
      "summary": "Verify the project routing mode and place the API handlers accordingly: confirm whether the project is using Next.js App Router (`/app`) or Pages Router (`/pages`), and ensure exactly one correct set of handlers is present and used by the runtime so `/api/*` endpoints are reachable after deployment.",
      "reqIds": [
        "REQ-206"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Dart Scoring",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}